<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎯 技术洞察系统 - 监控仪表板</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/mobile.css">
    <meta name="theme-color" content="#2563eb">
    <meta name="description" content="技术洞察系统实时监控仪表板">
    
    <!-- 简化图标引用 -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎯</text></svg>">
</head>
<body>
    <!-- 加载遮罩层 -->
    <div id="loadingOverlay" class="loading-overlay" style="display: flex;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>技术洞察系统</h3>
            <p id="loadingMessage">正在初始化系统...</p>
            <div class="loading-progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>
    </div>

    <!-- 错误模态框 -->
    <div id="errorModal" class="error-modal hidden">
        <div class="error-content">
            <div class="error-header">
                <h3>🚨 系统错误</h3>
                <button class="close-btn" id="closeError">&times;</button>
            </div>
            <div class="error-body">
                <p id="errorMessage">发生未知错误</p>
            </div>
            <div class="error-footer">
                <button class="btn-retry" id="retryBtn">🔄 重试</button>
            </div>
        </div>
    </div>

    <!-- 设置面板 -->
    <div id="settingsPanel" class="settings-panel hidden">
        <div class="settings-content">
            <div class="settings-header">
                <h3>⚙️ 系统设置</h3>
                <button class="close-btn" id="closeSettings">&times;</button>
            </div>
            <div class="settings-body">
                <div class="setting-group">
                    <label for="refreshInterval">自动刷新间隔</label>
                    <select id="refreshInterval">
                        <option value="60000">1分钟</option>
                        <option value="300000" selected>5分钟</option>
                        <option value="600000">10分钟</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="timeRangeSelect">时间范围</label>
                    <select id="timeRangeSelect">
                        <option value="24h" selected>24小时</option>
                        <option value="7d">7天</option>
                        <option value="30d">30天</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="rankingCriteria">排行标准</label>
                    <select id="rankingCriteria">
                        <option value="signal_strength" selected>信号强度</option>
                        <option value="commercial_value">商业价值</option>
                        <option value="breakthrough_score">技术突破性</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="chartAnimation" checked>
                        启用动画效果
                    </label>
                </div>
                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="darkMode">
                        深色模式
                    </label>
                </div>
            </div>
            <div class="settings-footer">
                <button class="btn-save" id="saveSettings">💾 保存</button>
                <button class="btn-reset" id="resetSettings">🔄 重置</button>
            </div>
        </div>
    </div>

    <!-- 主仪表板容器 -->
    <div class="dashboard-container">
        <!-- 头部区域 -->
        <header class="dashboard-header">
            <div class="header-left">
                <h1>🎯 技术洞察系统</h1>
                <div class="system-status">
                    <span class="status-indicator" id="systemStatus">🔄 系统状态：正在初始化...</span>
                </div>
                <div class="version-info">监控仪表板 v1.0.0 - 业务版</div>
            </div>
            <div class="header-controls">
                <div class="last-update" id="lastUpdate">最后更新: --</div>
                <button class="btn-refresh" id="refreshBtn">🔄 刷新</button>
                <button class="btn-settings" id="settingsBtn">⚙️</button>
            </div>
        </header>

        <!-- 主内容区域 -->
        <main class="dashboard-main">
            <!-- 核心指标卡片网格 -->
            <section class="metrics-section">
                <div class="metrics-grid">
                    <!-- 系统健康度卡片 -->
                    <div class="metric-card health-card">
                        <div class="metric-header">
                            <h3>📊 系统健康度</h3>
                            <div class="metric-icon" id="healthIcon">💚</div>
                        </div>
                        <div class="metric-value" id="systemHealth">--</div>
                        <div class="metric-trend neutral" id="healthTrend">系统初始化中</div>
                        <div class="metric-detail" id="healthDetail">正在检测系统状态</div>
                        <div class="health-progress">
                            <div class="progress-bar" id="healthProgressBar" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- 今日洞察卡片 -->
                    <div class="metric-card insights-card">
                        <div class="metric-header">
                            <h3>📈 今日洞察</h3>
                            <div class="metric-icon">📊</div>
                        </div>
                        <div class="metric-value" id="todayInsights">--</div>
                        <div class="metric-trend positive" id="insightsTrend">👆 与昨日对比</div>
                        <div class="metric-detail" id="insightsDetail">包含高价值洞察 -- 条</div>
                    </div>

                    <!-- 告警数量卡片 -->
                    <div class="metric-card alert-card">
                        <div class="metric-header">
                            <h3>⚠️ 告警数量</h3>
                            <div class="metric-icon">🚨</div>
                        </div>
                        <div class="metric-value" id="alertCount">--</div>
                        <div class="metric-trend neutral" id="alertTrend">👆 需要关注</div>
                        <div class="metric-detail" id="alertDetail">-- 个高优先级告警</div>
                    </div>

                    <!-- 运行状态卡片 -->
                    <div class="metric-card workflow-card">
                        <div class="metric-header">
                            <h3>🔄 运行状态</h3>
                            <div class="metric-icon">⚡</div>
                        </div>
                        <div class="metric-value" id="runningWorkflows">运行中</div>
                        <div class="metric-trend positive" id="workflowTrend">-- 个工作流</div>
                        <div class="metric-detail" id="workflowDetail">系统正常运行</div>
                    </div>
                </div>
            </section>

            <!-- 数据流转分析 - 横向优化版 -->
            <section class="data-flow-section">
                <div class="section-header">
                    <h2>📊 核心业务可视化</h2>
                </div>
                <div class="section-subtitle">数据收敛流转分析</div>
                <div class="flow-description">📊 展示从原始数据到最终技术线索的收敛过程和数量分布</div>
                
                <!-- 数据流转统计 -->
                <div class="data-flow-stats">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">转化率</div>
                            <div class="stat-value" id="conversionRate">--</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">处理效率</div>
                            <div class="stat-value" id="processingEfficiency">--</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">总输入</div>
                            <div class="stat-value" id="totalInput">--</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">总输出</div>
                            <div class="stat-value" id="totalOutput">--</div>
                        </div>
                    </div>
                </div>
                
                <!-- 横向流转步骤展示 -->
                <div class="flow-pipeline">
                    <div class="pipeline-container">
                        <div class="pipeline-step" id="rawDataStep">
                            <div class="step-header">
                                <div class="step-icon">📥</div>
                                <h4>原始数据</h4>
                                <span class="step-tag">RAW</span>
                            </div>
                            <div class="step-value" id="rawDataCount">355</div>
                            <div class="step-detail">学术论文、专利、新闻等</div>
                            <div class="step-progress-bar">
                                <div class="progress-fill" style="width: 100%"></div>
                            </div>
                        </div>

                        <div class="pipeline-arrow">
                            <div class="arrow-line"></div>
                            <div class="arrow-head">▶</div>
                            <div class="conversion-rate" id="rawToIntel">87%</div>
                        </div>

                        <div class="pipeline-step" id="intelligenceStep">
                            <div class="step-header">
                                <div class="step-icon">🧠</div>
                                <h4>智能洞察</h4>
                                <span class="step-tag">Intelligence</span>
                            </div>
                            <div class="step-value" id="intelligenceCount">16</div>
                            <div class="step-detail">AI识别的技术信号</div>
                            <div class="step-progress-bar">
                                <div class="progress-fill" style="width: 87%"></div>
                            </div>
                        </div>

                        <div class="pipeline-arrow">
                            <div class="arrow-line"></div>
                            <div class="arrow-head">▶</div>
                            <div class="conversion-rate" id="intelToClues">78%</div>
                        </div>

                        <div class="pipeline-step" id="cluesStep">
                            <div class="step-header">
                                <div class="step-icon">🔍</div>
                                <h4>技术线索</h4>
                                <span class="step-tag">Clues</span>
                            </div>
                            <div class="step-value" id="cluesCount">9</div>
                            <div class="step-detail">验证通过的有效线索</div>
                            <div class="step-progress-bar">
                                <div class="progress-fill" style="width: 78%"></div>
                            </div>
                        </div>

                        <div class="pipeline-arrow">
                            <div class="arrow-line"></div>
                            <div class="arrow-head">▶</div>
                            <div class="conversion-rate" id="cluesToActions">65%</div>
                        </div>

                        <div class="pipeline-step" id="actionsStep">
                            <div class="step-header">
                                <div class="step-icon">🎯</div>
                                <h4>行动建议</h4>
                                <span class="step-tag">Actions</span>
                            </div>
                            <div class="step-value" id="actionsCount">0</div>
                            <div class="step-detail">可执行的决策建议</div>
                            <div class="step-progress-bar">
                                <div class="progress-fill" style="width: 65%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 工作流状态监控 - 优化为一页显示 -->
            <section class="workflow-section">
                <div class="section-header">
                    <h2>工作流实时状态监控</h2>
                </div>
                <div class="section-subtitle">🔄 显示当前所有工作流的最新执行状态和时间信息</div>

                <div class="workflow-status-panel">
                    <div class="panel-header">
                        <h3>当前工作流状态</h3>
                        <div class="status-legend">
                            <div class="legend-item">
                                <div class="dot success"></div>
                                <span>已完成</span>
                            </div>
                            <div class="legend-item">
                                <div class="dot warning"></div>
                                <span>运行中</span>
                            </div>
                            <div class="legend-item">
                                <div class="dot danger"></div>
                                <span>失败</span>
                            </div>
                            <div class="legend-item">
                                <div class="dot secondary"></div>
                                <span>等待中</span>
                            </div>
                        </div>
                    </div>
                    <!-- 工作流网格布局 -->
                    <div class="workflow-grid" id="workflowList">
                        <div class="loading">正在加载工作流状态...</div>
                    </div>
                </div>
            </section>

            <!-- 业务价值分析 -->
            <section class="value-section">
                <div class="section-header">
                    <h2>💰 业务价值分析</h2>
                </div>

                <div class="value-stats">
                    <div class="value-stat-item">
                        <div class="stat-icon">🎯</div>
                        <div class="stat-content">
                            <div class="stat-label">高价值洞察</div>
                            <div class="stat-value" id="highValueCount">--</div>
                        </div>
                    </div>
                    <div class="value-stat-item">
                        <div class="stat-icon">💎</div>
                        <div class="stat-content">
                            <div class="stat-label">投资机会</div>
                            <div class="stat-value" id="investmentOpportunities">--</div>
                        </div>
                    </div>
                </div>

                <div class="top-intelligence-panel">
                    <div class="panel-header">
                        <h3>TOP 洞察排行</h3>
                        <div class="chart-controls">
                            <select id="rankingSelect">
                                <option value="signal_strength">信号强度</option>
                                <option value="commercial_value">商业价值</option>
                                <option value="breakthrough_score">技术突破性</option>
                            </select>
                        </div>
                    </div>
                    <div class="intelligence-list" id="intelligenceList">
                        <div class="loading">正在加载洞察数据...</div>
                    </div>
                </div>
            </section>

            <!-- 技术趋势分析 -->
            <section class="trends-section">
                <div class="section-header">
                    <h2>🔥 技术趋势分析</h2>
                </div>

                <div class="trends-stats-panel">
                    <div class="panel-header">
                        <h3>趋势统计</h3>
                    </div>
                    <div class="trends-list" id="trendsList">
                        <div class="loading">正在分析趋势...</div>
                    </div>
                </div>
            </section>

            <!-- 系统控制面板 -->
            <section class="control-section">
                <div class="panel-header">
                    <h3>🎛️ 系统控制</h3>
                </div>
                <div class="control-buttons">
                    <button class="control-btn primary" id="processBtn">
                        🔄 处理请求
                    </button>
                    <button class="control-btn secondary" id="resetBtn">
                        🔄 重置系统
                    </button>
                    <button class="control-btn info" id="exportBtn">
                        📤 导出数据
                    </button>
                </div>
                <div class="control-status" id="controlStatus">
                    <div class="status-message">
                        <span class="status-icon">✅</span>
                        <span class="status-text">系统运行正常 - 所有服务已启动</span>
                    </div>
                </div>
            </section>
        </main>

        <!-- 页脚 -->
        <footer class="dashboard-footer">
            <div class="footer-content">
                <div class="footer-left">
                    <p>© 2024 技术洞察决策引擎 | 实时监控仪表板 | 数据源: Google Sheets | v1.0.0 - 业务版</p>
                </div>
                <div class="footer-right">
                    <span>部署时间: <span id="deployTime">2024-06-22 08:00:00</span></span>
                    <span class="separator">|</span>
                    <span>最后更新: <span id="footerUpdate">--</span></span>
                    <span class="separator">|</span>
                    <span>API状态: <span class="api-status" id="apiStatus">检测中</span></span>
                    <span class="separator">|</span>
                    <span>数据条数: <span id="dataCount">0</span></span>
                </div>
            </div>
        </footer>
    </div>

    <!-- 脚本按顺序加载 -->
    <script src="config/config.js"></script>
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/api.js"></script>
    <script src="assets/js/charts.js"></script>
    <script src="assets/js/app.js"></script>

    <!-- 优化后的样式 -->
    <style>
        /* 横向流转管道样式 */
        .flow-pipeline {
            margin: 2rem 0;
            padding: 2rem;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 1rem;
            border: 1px solid var(--border-color, #e2e8f0);
        }

        .pipeline-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            overflow-x: auto;
            padding: 1rem 0;
        }

        .pipeline-step {
            flex: 1;
            min-width: 200px;
            background: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            text-align: center;
        }

        .pipeline-step:hover {
            border-color: var(--primary-color, #2563eb);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .step-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .step-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .step-header h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary, #1e293b);
            margin: 0;
        }

        .step-tag {
            background: var(--primary-color, #2563eb);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .step-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color, #2563eb);
            margin: 0.5rem 0;
            font-variant-numeric: tabular-nums;
        }

        .step-detail {
            font-size: 0.875rem;
            color: var(--text-secondary, #64748b);
            margin-bottom: 1rem;
        }

        .step-progress-bar {
            width: 100%;
            height: 6px;
            background: var(--bg-tertiary, #f1f5f9);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color, #2563eb), var(--primary-light, #3b82f6));
            border-radius: 3px;
            transition: width 0.8s ease;
        }

        .pipeline-arrow {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 0.5rem;
            flex-shrink: 0;
        }

        .arrow-line {
            width: 40px;
            height: 2px;
            background: var(--primary-color, #2563eb);
            margin-bottom: 0.25rem;
        }

        .arrow-head {
            font-size: 1.5rem;
            color: var(--primary-color, #2563eb);
            margin-bottom: 0.25rem;
        }

        .conversion-rate {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--success-color, #10b981);
            background: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* 工作流网格布局 */
        .workflow-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            padding: 1rem;
            max-height: none; /* 移除高度限制，显示所有工作流 */
        }

        .workflow-card {
            background: white;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color, #e2e8f0);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        .workflow-card:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        .workflow-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .workflow-name {
            font-weight: 600;
            color: var(--text-primary, #1e293b);
            font-size: 0.875rem;
        }

        .workflow-status {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .workflow-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            color: var(--text-secondary, #64748b);
        }

        .workflow-time {
            font-variant-numeric: tabular-nums;
        }

        /* 响应式优化 */
        @media (max-width: 768px) {
            .pipeline-container {
                flex-direction: column;
                gap: 1rem;
            }

            .pipeline-arrow {
                transform: rotate(90deg);
                margin: 0.5rem 0;
            }

            .arrow-line {
                width: 30px;
            }

            .workflow-grid {
                grid-template-columns: 1fr;
            }

            .pipeline-step {
                min-width: auto;
                width: 100%;
            }
        }

        /* 其他现有样式保持不变 */
        .data-flow-stats {
            margin: 2rem 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-item {
            background: var(--bg-secondary, #f1f5f9);
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            border: 1px solid var(--border-color, #e2e8f0);
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary, #64748b);
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color, #2563eb);
        }
        
        .value-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .value-stat-item {
            background: var(--bg-card, #ffffff);
            padding: 1.5rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color, #e2e8f0);
        }
        
        .stat-icon {
            font-size: 2rem;
            opacity: 0.8;
        }
        
        .stat-content .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary, #64748b);
        }
        
        .stat-content .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary, #1e293b);
        }
        
        .health-progress {
            width: 100%;
            height: 4px;
            background: var(--bg-tertiary, #f1f5f9);
            border-radius: 0.25rem;
            overflow: hidden;
            margin-top: 1rem;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color, #10b981), var(--success-light, #34d399));
            border-radius: 0.25rem;
            transition: width 0.5s ease-in-out;
        }
    </style>
</body>
</html>
