**æŠ€æœ¯æ´å¯Ÿåˆ†æå¼•æ“ - ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ï¼ˆæ¶æ„æ˜ç¡®ç‰ˆï¼‰**

---

**ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ€æœ¯æ¶æ„æ˜ç¡®è¯´æ˜**

**æ ¸å¿ƒæ¶æ„ï¼šGoogle Apps Script + HTML Service**

**æŠ€æœ¯æ ˆç»„æˆï¼š**
```
æ•°æ®å±‚: Google Sheets (6ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“)
  â†“
æ•°æ®æœåŠ¡å±‚: Google Apps Script (.gsæ–‡ä»¶)
  â†“  
å‰ç«¯å±•ç¤ºå±‚: HTML Service (.htmlæ–‡ä»¶)
  â†“
ç”¨æˆ·è®¿é—®: Googleæ‰˜ç®¡çš„Webåº”ç”¨URL
```

**æ„å»ºå’Œéƒ¨ç½²å¹³å°ï¼š**
- **å¼€å‘å¹³å°**: Google Apps Scriptåœ¨çº¿ç¼–è¾‘å™¨ (script.google.com)
- **è¿è¡Œå¹³å°**: Google Cloud Platform (Apps Script Runtime)
- **æ‰˜ç®¡å¹³å°**: Google Apps Script Webåº”ç”¨æœåŠ¡
- **è®¿é—®URL**: `https://script.google.com/macros/s/{DEPLOYMENT_ID}/exec`

**ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªæ¶æ„ï¼š**
1. **ä¸ç°æœ‰ç³»ç»Ÿå®Œç¾é›†æˆ**: Makeå·¥ä½œæµ â†’ Google Sheets â†’ Apps Script â†’ HTML Service
2. **é›¶åŸºç¡€è®¾æ–½æˆæœ¬**: å®Œå…¨è¿è¡Œåœ¨Googleäº‘ç¯å¢ƒä¸­
3. **æ— CORSé—®é¢˜**: å‰åç«¯åœ¨åŒä¸€GoogleåŸŸåä¸‹
4. **ç®€åŒ–å¼€å‘æµç¨‹**: ä¸€ä¸ªå¹³å°å®Œæˆå¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²
5. **è‡ªåŠ¨æ‰©å±•**: Googleè‡ªåŠ¨å¤„ç†è´Ÿè½½å’Œå¹¶å‘

---

**ç¬¬äºŒéƒ¨åˆ†ï¼šé¡¹ç›®æ„å»ºç»“æ„**

**Google Apps Scripté¡¹ç›®æ–‡ä»¶ç»“æ„ï¼š**
```
æŠ€æœ¯æ´å¯Ÿåˆ†æå¼•æ“ (Apps Script Project)
â”œâ”€â”€ åç«¯æœåŠ¡æ–‡ä»¶ (.gs)
â”‚   â”œâ”€â”€ Code.gs                    # ä¸»å…¥å£å’Œè·¯ç”±æ§åˆ¶
â”‚   â”œâ”€â”€ DataService.gs             # æ•°æ®æœåŠ¡å±‚
â”‚   â”œâ”€â”€ ReportService.gs           # æŠ¥å‘Šç”ŸæˆæœåŠ¡
â”‚   â”œâ”€â”€ ActionService.gs           # è¡ŒåŠ¨ç®¡ç†æœåŠ¡
â”‚   â””â”€â”€ Config.gs                  # é…ç½®ç®¡ç†
â”œâ”€â”€ å‰ç«¯é¡µé¢æ–‡ä»¶ (.html)
â”‚   â”œâ”€â”€ index.html                 # ä¸»ä»ªè¡¨æ¿
â”‚   â”œâ”€â”€ collection.html            # æ•°æ®é‡‡é›†ç›‘æ§
â”‚   â”œâ”€â”€ insights.html              # æŠ€æœ¯æ´å¯Ÿåˆ†æ
â”‚   â”œâ”€â”€ actions.html               # å†³ç­–è¡ŒåŠ¨ä¸­å¿ƒ
â”‚   â””â”€â”€ reports.html               # æŠ¥å‘Šä¸­å¿ƒ
â”œâ”€â”€ ç»„ä»¶æ–‡ä»¶ (.html)
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ header.html            # é¡¶éƒ¨å¯¼èˆªç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ modal.html             # é€šç”¨å¼¹çª—ç»„ä»¶
â”‚   â”‚   â””â”€â”€ chart.html             # å›¾è¡¨ç»„ä»¶
â”œâ”€â”€ æ ·å¼æ–‡ä»¶ (.html)
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”œâ”€â”€ main.css               # ä¸»æ ·å¼è¡¨
â”‚   â”‚   â”œâ”€â”€ components.css         # ç»„ä»¶æ ·å¼
â”‚   â”‚   â””â”€â”€ responsive.css         # å“åº”å¼æ ·å¼
â””â”€â”€ è„šæœ¬æ–‡ä»¶ (.html)
    â””â”€â”€ scripts/
        â”œâ”€â”€ main.js                # ä¸»äº¤äº’é€»è¾‘
        â”œâ”€â”€ charts.js              # å›¾è¡¨å¤„ç†
        â””â”€â”€ utils.js               # å·¥å…·å‡½æ•°
```

**æ„å»ºæµç¨‹ï¼š**
1. **å¼€å‘é˜¶æ®µ**: åœ¨Google Apps Scriptç¼–è¾‘å™¨ä¸­ç¼–å†™ä»£ç 
2. **æµ‹è¯•é˜¶æ®µ**: ä½¿ç”¨Apps Scriptå†…ç½®çš„æµ‹è¯•åŠŸèƒ½
3. **éƒ¨ç½²é˜¶æ®µ**: å‘å¸ƒä¸ºWebåº”ç”¨ï¼Œè·å¾—è®¿é—®URL
4. **ç»´æŠ¤é˜¶æ®µ**: é€šè¿‡ç‰ˆæœ¬ç®¡ç†è¿›è¡Œæ›´æ–°å’Œå›æ»š

---

**ç¬¬ä¸‰éƒ¨åˆ†ï¼šæŠ¥å‘ŠåŠŸèƒ½å®Œæ•´è®¾è®¡**

**æŠ¥å‘Šç”Ÿæˆæ¶æ„ï¼š**

**ReportService.gs - æŠ¥å‘Šç”Ÿæˆåç«¯æœåŠ¡ï¼š**
```javascript
// æŠ¥å‘Šç”Ÿæˆä¸»æœåŠ¡ç±»
class TechInsightReportService {
  
  constructor() {
    this.templateEngine = new ReportTemplateEngine();
    this.dataAggregator = new ReportDataAggregator();
    this.exportService = new ReportExportService();
  }
  
  // ç”Ÿæˆæ—¥æŠ¥
  generateDailyReport(date = new Date()) {
    try {
      // æ”¶é›†æ—¥æŠ¥æ•°æ®
      const reportData = this.dataAggregator.collectDailyData(date);
      
      // ç”ŸæˆæŠ¥å‘Šå†…å®¹
      const reportContent = this.templateEngine.renderDailyTemplate(reportData);
      
      // ä¿å­˜æŠ¥å‘Šåˆ°æ•°æ®åº“
      const reportId = this.saveReportToDatabase('daily', date, reportContent, reportData);
      
      // ç”ŸæˆPDFå’ŒExcelç‰ˆæœ¬
      this.exportService.generateMultipleFormats(reportId, reportContent, reportData);
      
      // è‡ªåŠ¨åˆ†å‘æŠ¥å‘Š
      this.distributeReport(reportId, 'daily');
      
      return {
        success: true,
        reportId: reportId,
        message: 'æ—¥æŠ¥ç”ŸæˆæˆåŠŸ'
      };
      
    } catch (error) {
      console.error('ç”Ÿæˆæ—¥æŠ¥å¤±è´¥:', error);
      throw new Error(`æ—¥æŠ¥ç”Ÿæˆå¤±è´¥: ${error.message}`);
    }
  }
  
  // ç”Ÿæˆå‘¨æŠ¥
  generateWeeklyReport(weekStartDate) {
    try {
      const weekEndDate = new Date(weekStartDate);
      weekEndDate.setDate(weekEndDate.getDate() + 6);
      
      const reportData = this.dataAggregator.collectWeeklyData(weekStartDate, weekEndDate);
      const reportContent = this.templateEngine.renderWeeklyTemplate(reportData);
      const reportId = this.saveReportToDatabase('weekly', weekStartDate, reportContent, reportData);
      
      this.exportService.generateMultipleFormats(reportId, reportContent, reportData);
      this.distributeReport(reportId, 'weekly');
      
      return {
        success: true,
        reportId: reportId,
        message: 'å‘¨æŠ¥ç”ŸæˆæˆåŠŸ'
      };
      
    } catch (error) {
      console.error('ç”Ÿæˆå‘¨æŠ¥å¤±è´¥:', error);
      throw new Error(`å‘¨æŠ¥ç”Ÿæˆå¤±è´¥: ${error.message}`);
    }
  }
  
  // ç”ŸæˆæœˆæŠ¥
  generateMonthlyReport(year, month) {
    try {
      const reportData = this.dataAggregator.collectMonthlyData(year, month);
      const reportContent = this.templateEngine.renderMonthlyTemplate(reportData);
      const reportId = this.saveReportToDatabase('monthly', new Date(year, month - 1), reportContent, reportData);
      
      this.exportService.generateMultipleFormats(reportId, reportContent, reportData);
      this.distributeReport(reportId, 'monthly');
      
      return {
        success: true,
        reportId: reportId,
        message: 'æœˆæŠ¥ç”ŸæˆæˆåŠŸ'
      };
      
    } catch (error) {
      console.error('ç”ŸæˆæœˆæŠ¥å¤±è´¥:', error);
      throw new Error(`æœˆæŠ¥ç”Ÿæˆå¤±è´¥: ${error.message}`);
    }
  }
  
  // ç”Ÿæˆå¹´æŠ¥
  generateYearlyReport(year) {
    try {
      const reportData = this.dataAggregator.collectYearlyData(year);
      const reportContent = this.templateEngine.renderYearlyTemplate(reportData);
      const reportId = this.saveReportToDatabase('yearly', new Date(year, 0), reportContent, reportData);
      
      this.exportService.generateMultipleFormats(reportId, reportContent, reportData);
      this.distributeReport(reportId, 'yearly');
      
      return {
        success: true,
        reportId: reportId,
        message: 'å¹´æŠ¥ç”ŸæˆæˆåŠŸ'
      };
      
    } catch (error) {
      console.error('ç”Ÿæˆå¹´æŠ¥å¤±è´¥:', error);
      throw new Error(`å¹´æŠ¥ç”Ÿæˆå¤±è´¥: ${error.message}`);
    }
  }
}

// æŠ¥å‘Šæ•°æ®èšåˆå™¨
class ReportDataAggregator {
  
  // æ”¶é›†æ—¥æŠ¥æ•°æ®
  collectDailyData(date) {
    const dateStr = Utilities.formatDate(date, Session.getScriptTimeZone(), 'yyyy-MM-dd');
    
    return {
      reportDate: dateStr,
      generatedAt: new Date().toISOString(),
      
      // æ ¸å¿ƒæŒ‡æ ‡
      metrics: {
        newInsights: this.getNewInsightsCount(dateStr),
        highValueInsights: this.getHighValueInsightsCount(dateStr),
        actionItems: this.getActionItemsCount(dateStr),
        dataQuality: this.calculateDataQuality(dateStr)
      },
      
      // é‡ç‚¹æ´å¯Ÿ
      topInsights: this.getTopInsights(dateStr, 5),
      
      // å¸‚åœºæƒ…æŠ¥
      marketUpdates: this.getMarketUpdates(dateStr),
      
      // è¡ŒåŠ¨å»ºè®®
      actionRecommendations: this.getActionRecommendations(dateStr),
      
      // æ•°æ®æºç»Ÿè®¡
      dataSources: this.getDataSourceStats(dateStr),
      
      // ç³»ç»Ÿå¥åº·åº¦
      systemHealth: this.getSystemHealthMetrics(dateStr)
    };
  }
  
  // æ”¶é›†å‘¨æŠ¥æ•°æ®
  collectWeeklyData(startDate, endDate) {
    const startStr = Utilities.formatDate(startDate, Session.getScriptTimeZone(), 'yyyy-MM-dd');
    const endStr = Utilities.formatDate(endDate, Session.getScriptTimeZone(), 'yyyy-MM-dd');
    
    return {
      reportPeriod: `${startStr} è‡³ ${endStr}`,
      weekNumber: this.getWeekNumber(startDate),
      generatedAt: new Date().toISOString(),
      
      // å‘¨åº¦æ±‡æ€»æŒ‡æ ‡
      weeklyMetrics: {
        totalInsights: this.getInsightsCountInPeriod(startStr, endStr),
        avgDailyInsights: this.getAvgDailyInsights(startStr, endStr),
        completedActions: this.getCompletedActionsCount(startStr, endStr),
        trendAnalysis: this.getTrendAnalysis(startStr, endStr)
      },
      
      // é‡è¦å‘ç°
      keyFindings: this.getKeyFindings(startStr, endStr),
      
      // æŠ€æœ¯è¶‹åŠ¿
      techTrends: this.getTechTrends(startStr, endStr),
      
      // ç«äº‰åŠ¨æ€
      competitiveDynamics: this.getCompetitiveDynamics(startStr, endStr),
      
      // æŠ•èµ„æœºä¼š
      investmentOpportunities: this.getInvestmentOpportunities(startStr, endStr)
    };
  }
  
  // æ”¶é›†æœˆæŠ¥æ•°æ®
  collectMonthlyData(year, month) {
    const startDate = new Date(year, month - 1, 1);
    const endDate = new Date(year, month, 0);
    const startStr = Utilities.formatDate(startDate, Session.getScriptTimeZone(), 'yyyy-MM-dd');
    const endStr = Utilities.formatDate(endDate, Session.getScriptTimeZone(), 'yyyy-MM-dd');
    
    return {
      reportPeriod: `${year}å¹´${month}æœˆ`,
      generatedAt: new Date().toISOString(),
      
      // æœˆåº¦æ±‡æ€»
      monthlyMetrics: {
        totalInsights: this.getInsightsCountInPeriod(startStr, endStr),
        highImpactInsights: this.getHighImpactInsightsCount(startStr, endStr),
        investmentDecisions: this.getInvestmentDecisionsCount(startStr, endStr),
        roiRealized: this.getROIRealized(startStr, endStr)
      },
      
      // æŠ€æœ¯é¢†åŸŸåˆ†æ
      technologyDomains: this.getTechnologyDomainsAnalysis(startStr, endStr),
      
      // å¸‚åœºæœºä¼šåˆ†æ
      marketOpportunities: this.getMarketOpportunitiesAnalysis(startStr, endStr),
      
      // ç«äº‰æ ¼å±€åˆ†æ
      competitiveLandscape: this.getCompetitiveLandscapeAnalysis(startStr, endStr),
      
      // æŠ•èµ„ç»„åˆåˆ†æ
      portfolioAnalysis: this.getPortfolioAnalysis(startStr, endStr)
    };
  }
  
  // æ”¶é›†å¹´æŠ¥æ•°æ®
  collectYearlyData(year) {
    const startDate = new Date(year, 0, 1);
    const endDate = new Date(year, 11, 31);
    const startStr = Utilities.formatDate(startDate, Session.getScriptTimeZone(), 'yyyy-MM-dd');
    const endStr = Utilities.formatDate(endDate, Session.getScriptTimeZone(), 'yyyy-MM-dd');
    
    return {
      reportYear: year,
      generatedAt: new Date().toISOString(),
      
      // å¹´åº¦æ±‡æ€»
      yearlyMetrics: {
        totalInsights: this.getInsightsCountInPeriod(startStr, endStr),
        majorBreakthroughs: this.getMajorBreakthroughs(startStr, endStr),
        successfulInvestments: this.getSuccessfulInvestments(startStr, endStr),
        totalROI: this.getTotalROI(startStr, endStr)
      },
      
      // å¹´åº¦æŠ€æœ¯è¶‹åŠ¿
      yearlyTechTrends: this.getYearlyTechTrends(startStr, endStr),
      
      // è¡Œä¸šæ ¼å±€å˜åŒ–
      industryLandscapeChanges: this.getIndustryLandscapeChanges(startStr, endStr),
      
      // æŠ•èµ„å›é¡¾
      investmentReview: this.getInvestmentReview(startStr, endStr),
      
      // ä¸‹å¹´åº¦å±•æœ›
      nextYearOutlook: this.generateNextYearOutlook(year)
    };
  }
}
```

**æŠ¥å‘Šæ¨¡æ¿å¼•æ“ï¼š**
```javascript
// æŠ¥å‘Šæ¨¡æ¿å¼•æ“
class ReportTemplateEngine {
  
  // æ¸²æŸ“æ—¥æŠ¥æ¨¡æ¿
  renderDailyTemplate(data) {
    return `
      <div class="daily-report">
        <div class="report-header">
          <h1>æŠ€æœ¯æ´å¯Ÿæ—¥æŠ¥</h1>
          <div class="report-meta">
            <span>æŠ¥å‘Šæ—¥æœŸ: ${data.reportDate}</span>
            <span>ç”Ÿæˆæ—¶é—´: ${new Date(data.generatedAt).toLocaleString()}</span>
          </div>
        </div>
        
        <div class="executive-summary">
          <h2>æ‰§è¡Œæ‘˜è¦</h2>
          <div class="summary-metrics">
            <div class="metric-item">
              <span class="metric-label">æ–°å¢æ´å¯Ÿ:</span>
              <span class="metric-value">${data.metrics.newInsights}</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">é«˜ä»·å€¼å‘ç°:</span>
              <span class="metric-value">${data.metrics.highValueInsights}</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">è¡ŒåŠ¨å»ºè®®:</span>
              <span class="metric-value">${data.metrics.actionItems}</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">æ•°æ®è´¨é‡:</span>
              <span class="metric-value">${data.metrics.dataQuality}/10</span>
            </div>
          </div>
        </div>
        
        <div class="top-insights-section">
          <h2>é‡ç‚¹æ´å¯Ÿ</h2>
          ${this.renderInsightsList(data.topInsights)}
        </div>
        
        <div class="market-intelligence-section">
          <h2>å¸‚åœºæƒ…æŠ¥</h2>
          ${this.renderMarketUpdates(data.marketUpdates)}
        </div>
        
        <div class="action-recommendations-section">
          <h2>è¡ŒåŠ¨å»ºè®®</h2>
          ${this.renderActionRecommendations(data.actionRecommendations)}
        </div>
        
        <div class="data-sources-section">
          <h2>æ•°æ®æ¥æºç»Ÿè®¡</h2>
          ${this.renderDataSourceStats(data.dataSources)}
        </div>
        
        <div class="system-health-section">
          <h2>ç³»ç»Ÿå¥åº·åº¦</h2>
          ${this.renderSystemHealth(data.systemHealth)}
        </div>
      </div>
    `;
  }
  
  // æ¸²æŸ“å‘¨æŠ¥æ¨¡æ¿
  renderWeeklyTemplate(data) {
    return `
      <div class="weekly-report">
        <div class="report-header">
          <h1>æŠ€æœ¯æ´å¯Ÿå‘¨æŠ¥</h1>
          <div class="report-meta">
            <span>æŠ¥å‘ŠæœŸé—´: ${data.reportPeriod}</span>
            <span>ç¬¬${data.weekNumber}å‘¨</span>
            <span>ç”Ÿæˆæ—¶é—´: ${new Date(data.generatedAt).toLocaleString()}</span>
          </div>
        </div>
        
        <div class="weekly-summary">
          <h2>å‘¨åº¦æ±‡æ€»</h2>
          <div class="weekly-metrics-grid">
            <div class="metric-card">
              <div class="metric-number">${data.weeklyMetrics.totalInsights}</div>
              <div class="metric-label">æ€»æ´å¯Ÿæ•°</div>
            </div>
            <div class="metric-card">
              <div class="metric-number">${data.weeklyMetrics.avgDailyInsights}</div>
              <div class="metric-label">æ—¥å‡æ´å¯Ÿ</div>
            </div>
            <div class="metric-card">
              <div class="metric-number">${data.weeklyMetrics.completedActions}</div>
              <div class="metric-label">å®Œæˆè¡ŒåŠ¨</div>
            </div>
          </div>
        </div>
        
        <div class="key-findings-section">
          <h2>é‡è¦å‘ç°</h2>
          ${this.renderKeyFindings(data.keyFindings)}
        </div>
        
        <div class="tech-trends-section">
          <h2>æŠ€æœ¯è¶‹åŠ¿</h2>
          ${this.renderTechTrends(data.techTrends)}
        </div>
        
        <div class="competitive-dynamics-section">
          <h2>ç«äº‰åŠ¨æ€</h2>
          ${this.renderCompetitiveDynamics(data.competitiveDynamics)}
        </div>
        
        <div class="investment-opportunities-section">
          <h2>æŠ•èµ„æœºä¼š</h2>
          ${this.renderInvestmentOpportunities(data.investmentOpportunities)}
        </div>
      </div>
    `;
  }
  
  // æ¸²æŸ“æœˆæŠ¥æ¨¡æ¿
  renderMonthlyTemplate(data) {
    return `
      <div class="monthly-report">
        <div class="report-header">
          <h1>æŠ€æœ¯æ´å¯ŸæœˆæŠ¥</h1>
          <div class="report-meta">
            <span>æŠ¥å‘ŠæœŸé—´: ${data.reportPeriod}</span>
            <span>ç”Ÿæˆæ—¶é—´: ${new Date(data.generatedAt).toLocaleString()}</span>
          </div>
        </div>
        
        <div class="monthly-overview">
          <h2>æœˆåº¦æ¦‚è§ˆ</h2>
          <div class="overview-grid">
            <div class="overview-item">
              <h3>æ´å¯Ÿå‘ç°</h3>
              <div class="overview-stats">
                <span>æ€»è®¡: ${data.monthlyMetrics.totalInsights}</span>
                <span>é«˜å½±å“: ${data.monthlyMetrics.highImpactInsights}</span>
              </div>
            </div>
            <div class="overview-item">
              <h3>æŠ•èµ„å†³ç­–</h3>
              <div class="overview-stats">
                <span>å†³ç­–æ•°: ${data.monthlyMetrics.investmentDecisions}</span>
                <span>å·²å®ç°ROI: ${data.monthlyMetrics.roiRealized}%</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="technology-domains-section">
          <h2>æŠ€æœ¯é¢†åŸŸåˆ†æ</h2>
          ${this.renderTechnologyDomains(data.technologyDomains)}
        </div>
        
        <div class="market-opportunities-section">
          <h2>å¸‚åœºæœºä¼šåˆ†æ</h2>
          ${this.renderMarketOpportunities(data.marketOpportunities)}
        </div>
        
        <div class="competitive-landscape-section">
          <h2>ç«äº‰æ ¼å±€åˆ†æ</h2>
          ${this.renderCompetitiveLandscape(data.competitiveLandscape)}
        </div>
        
        <div class="portfolio-analysis-section">
          <h2>æŠ•èµ„ç»„åˆåˆ†æ</h2>
          ${this.renderPortfolioAnalysis(data.portfolioAnalysis)}
        </div>
      </div>
    `;
  }
  
  // æ¸²æŸ“å¹´æŠ¥æ¨¡æ¿
  renderYearlyTemplate(data) {
    return `
      <div class="yearly-report">
        <div class="report-header">
          <h1>æŠ€æœ¯æ´å¯Ÿå¹´æŠ¥</h1>
          <div class="report-meta">
            <span>æŠ¥å‘Šå¹´åº¦: ${data.reportYear}</span>
            <span>ç”Ÿæˆæ—¶é—´: ${new Date(data.generatedAt).toLocaleString()}</span>
          </div>
        </div>
        
        <div class="yearly-summary">
          <h2>å¹´åº¦æ€»ç»“</h2>
          <div class="yearly-highlights">
            <div class="highlight-item">
              <h3>æ´å¯Ÿæˆæœ</h3>
              <div class="highlight-stats">
                <span>æ€»æ´å¯Ÿ: ${data.yearlyMetrics.totalInsights}</span>
                <span>é‡å¤§çªç ´: ${data.yearlyMetrics.majorBreakthroughs}</span>
              </div>
            </div>
            <div class="highlight-item">
              <h3>æŠ•èµ„å›æŠ¥</h3>
              <div class="highlight-stats">
                <span>æˆåŠŸæŠ•èµ„: ${data.yearlyMetrics.successfulInvestments}</span>
                <span>æ€»ROI: ${data.yearlyMetrics.totalROI}%</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="yearly-tech-trends-section">
          <h2>å¹´åº¦æŠ€æœ¯è¶‹åŠ¿</h2>
          ${this.renderYearlyTechTrends(data.yearlyTechTrends)}
        </div>
        
        <div class="industry-changes-section">
          <h2>è¡Œä¸šæ ¼å±€å˜åŒ–</h2>
          ${this.renderIndustryLandscapeChanges(data.industryLandscapeChanges)}
        </div>
        
        <div class="investment-review-section">
          <h2>æŠ•èµ„å›é¡¾</h2>
          ${this.renderInvestmentReview(data.investmentReview)}
        </div>
        
        <div class="next-year-outlook-section">
          <h2>ä¸‹å¹´åº¦å±•æœ›</h2>
          ${this.renderNextYearOutlook(data.nextYearOutlook)}
        </div>
      </div>
    `;
  }
}
```

**æŠ¥å‘Šè‡ªåŠ¨ç”Ÿæˆè§¦å‘å™¨è®¾ç½®ï¼š**
```javascript
// è®¾ç½®è‡ªåŠ¨æŠ¥å‘Šç”Ÿæˆè§¦å‘å™¨
function setupReportGenerationTriggers() {
  // åˆ é™¤ç°æœ‰è§¦å‘å™¨
  const triggers = ScriptApp.getProjectTriggers();
  triggers.forEach(trigger => {
    if (trigger.getHandlerFunction().startsWith('auto')) {
      ScriptApp.deleteTrigger(trigger);
    }
  });
  
  // æ—¥æŠ¥ç”Ÿæˆè§¦å‘å™¨ - æ¯æ—¥æ—©ä¸Š8ç‚¹
  ScriptApp.newTrigger('autoGenerateDailyReport')
    .timeBased()
    .everyDays(1)
    .atHour(8)
    .create();
  
  // å‘¨æŠ¥ç”Ÿæˆè§¦å‘å™¨ - æ¯å‘¨ä¸€æ—©ä¸Š9ç‚¹
  ScriptApp.newTrigger('autoGenerateWeeklyReport')
    .timeBased()
    .onWeekDay(ScriptApp.WeekDay.MONDAY)
    .atHour(9)
    .create();
  
  // æœˆæŠ¥ç”Ÿæˆè§¦å‘å™¨ - æ¯æœˆ1æ—¥æ—©ä¸Š10ç‚¹
  ScriptApp.newTrigger('autoGenerateMonthlyReport')
    .timeBased()
    .onMonthDay(1)
    .atHour(10)
    .create();
  
  // å¹´æŠ¥ç”Ÿæˆè§¦å‘å™¨ - æ¯å¹´1æœˆ15æ—¥
  ScriptApp.newTrigger('autoGenerateYearlyReport')
    .timeBased()
    .onMonthDay(15)
    .nearMinute(0)
    .inMonth(1)
    .create();
}

// è‡ªåŠ¨ç”Ÿæˆæ—¥æŠ¥
function autoGenerateDailyReport() {
  const reportService = new TechInsightReportService();
  const yesterday = new Date();
  yesterday.setDate(yesterday.getDate() - 1);
  
  try {
    const result = reportService.generateDailyReport(yesterday);
    console.log('æ—¥æŠ¥è‡ªåŠ¨ç”ŸæˆæˆåŠŸ:', result);
  } catch (error) {
    console.error('æ—¥æŠ¥è‡ªåŠ¨ç”Ÿæˆå¤±è´¥:', error);
    // å‘é€é”™è¯¯é€šçŸ¥
    sendErrorNotification('æ—¥æŠ¥ç”Ÿæˆå¤±è´¥', error.message);
  }
}

// è‡ªåŠ¨ç”Ÿæˆå‘¨æŠ¥
function autoGenerateWeeklyReport() {
  const reportService = new TechInsightReportService();
  const lastWeekStart = new Date();
  lastWeekStart.setDate(lastWeekStart.getDate() - 7);
  
  try {
    const result = reportService.generateWeeklyReport(lastWeekStart);
    console.log('å‘¨æŠ¥è‡ªåŠ¨ç”ŸæˆæˆåŠŸ:', result);
  } catch (error) {
    console.error('å‘¨æŠ¥è‡ªåŠ¨ç”Ÿæˆå¤±è´¥:', error);
    sendErrorNotification('å‘¨æŠ¥ç”Ÿæˆå¤±è´¥', error.message);
  }
}

// è‡ªåŠ¨ç”ŸæˆæœˆæŠ¥
function autoGenerateMonthlyReport() {
  const reportService = new TechInsightReportService();
  const lastMonth = new Date();
  lastMonth.setMonth(lastMonth.getMonth() - 1);
  
  try {
    const result = reportService.generateMonthlyReport(lastMonth.getFullYear(), lastMonth.getMonth() + 1);
    console.log('æœˆæŠ¥è‡ªåŠ¨ç”ŸæˆæˆåŠŸ:', result);
  } catch (error) {
    console.error('æœˆæŠ¥è‡ªåŠ¨ç”Ÿæˆå¤±è´¥:', error);
    sendErrorNotification('æœˆæŠ¥ç”Ÿæˆå¤±è´¥', error.message);
  }
}

// è‡ªåŠ¨ç”Ÿæˆå¹´æŠ¥
function autoGenerateYearlyReport() {
  const reportService = new TechInsightReportService();
  const lastYear = new Date().getFullYear() - 1;
  
  try {
    const result = reportService.generateYearlyReport(lastYear);
    console.log('å¹´æŠ¥è‡ªåŠ¨ç”ŸæˆæˆåŠŸ:', result);
  } catch (error) {
    console.error('å¹´æŠ¥è‡ªåŠ¨ç”Ÿæˆå¤±è´¥:', error);
    sendErrorNotification('å¹´æŠ¥ç”Ÿæˆå¤±è´¥', error.message);
  }
}
```

è¿™ä¸ªä¿®æ­£ç‰ˆæœ¬æ˜ç¡®äº†ï¼š

1. **æŠ€æœ¯æ¶æ„**: Google Apps Script + HTML Service
2. **æ„å»ºå¹³å°**: Google Apps Scriptåœ¨çº¿ç¼–è¾‘å™¨
3. **éƒ¨ç½²å¹³å°**: Google Cloud Platform Apps Script Runtime
4. **æŠ¥å‘ŠåŠŸèƒ½**: å®Œæ•´çš„æ—¥æŠ¥ã€å‘¨æŠ¥ã€æœˆæŠ¥ã€å¹´æŠ¥è‡ªåŠ¨ç”Ÿæˆç³»ç»Ÿ
5. **æ•°æ®é›†æˆ**: ä¸ç°æœ‰Makeå·¥ä½œæµå’ŒGoogle Sheetså®Œç¾é›†æˆ

æ•´ä¸ªç³»ç»Ÿå®Œå…¨åŸºäºGoogleç”Ÿæ€ï¼Œç¡®ä¿äº†æ¶æ„çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

**æŠ€æœ¯æ´å¯Ÿåˆ†æå¼•æ“ - ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ï¼ˆå®Œå–„ç‰ˆï¼‰**

---

**å…¨ç³»ç»Ÿæ•°å­—ç‚¹å‡»å±•å¼€è¯¦æƒ…è®¾è®¡**

**é€šç”¨æ•°å­—å±•å¼€äº¤äº’è§„èŒƒï¼š**

**è®¾è®¡åŸåˆ™ï¼š**
- æ‰€æœ‰é¡µé¢çš„æ•°å­—å‹æŒ‡æ ‡éƒ½æ”¯æŒç‚¹å‡»å±•å¼€
- ç»Ÿä¸€çš„äº¤äº’æ ·å¼å’Œè¡Œä¸ºæ¨¡å¼
- æ ¹æ®æ•°æ®é‡è‡ªåŠ¨é€‰æ‹©å±•ç¤ºæ–¹å¼
- æ”¯æŒå¤šçº§æ•°æ®é’»å–

**é€šç”¨CSSæ ·å¼è§„èŒƒï¼š**
```css
/* å¯ç‚¹å‡»æ•°å­—çš„é€šç”¨æ ·å¼ */
.clickable-number {
  cursor: pointer;
  transition: all 0.3s ease;
  border-radius: 4px;
  padding: 2px 4px;
}

.clickable-number:hover {
  background-color: #f0f8ff;
  transform: scale(1.05);
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.clickable-number::after {
  content: " ğŸ”";
  font-size: 0.8em;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.clickable-number:hover::after {
  opacity: 1;
}

/* ä¸åŒæ•°æ®é‡çº§çš„è§†è§‰æç¤º */
.clickable-number.small-data::after { content: " ğŸ“‹"; }
.clickable-number.medium-data::after { content: " ğŸ“Š"; }
.clickable-number.large-data::after { content: " ğŸ”—"; }
```

**é€šç”¨JavaScriptå±•å¼€é€»è¾‘ï¼š**
```javascript
// é€šç”¨æ•°å­—ç‚¹å‡»å¤„ç†å‡½æ•°
function handleNumberClick(element, dataType, value, metadata = {}) {
  const dataCount = metadata.count || value;
  const pageContext = metadata.page || getCurrentPage();
  
  // æ ¹æ®æ•°æ®é‡å†³å®šå±•ç¤ºæ–¹å¼
  if (dataCount <= 50) {
    showModalDetails(dataType, value, metadata);
  } else if (dataCount <= 500) {
    showExpandedModal(dataType, value, metadata);
  } else {
    openDetailPage(dataType, value, metadata);
  }
  
  // è®°å½•ç”¨æˆ·è¡Œä¸º
  logUserInteraction('number_click', {
    page: pageContext,
    dataType: dataType,
    value: value,
    timestamp: new Date().toISOString()
  });
}

// æ¨¡æ€æ¡†è¯¦æƒ…å±•ç¤º
function showModalDetails(dataType, value, metadata) {
  const modal = document.getElementById('universalDetailModal');
  const modalTitle = document.getElementById('modalTitle');
  const modalContent = document.getElementById('modalContent');
  
  modalTitle.textContent = generateModalTitle(dataType, value, metadata);
  modalContent.innerHTML = '<div class="loading-spinner">åŠ è½½ä¸­...</div>';
  
  modal.style.display = 'block';
  
  // å¼‚æ­¥åŠ è½½è¯¦ç»†æ•°æ®
  google.script.run
    .withSuccessHandler(data => renderModalContent(modalContent, data))
    .withFailureHandler(error => showErrorInModal(modalContent, error))
    .getDetailedData(dataType, metadata);
}

// æ–°é¡µé¢è¯¦æƒ…å±•ç¤º
function openDetailPage(dataType, value, metadata) {
  const params = new URLSearchParams({
    type: dataType,
    value: value,
    ...metadata
  });
  
  const detailUrl = `details.html?${params.toString()}`;
  window.open(detailUrl, '_blank', 'width=1200,height=800,scrollbars=yes');
}
```

---

**å„é¡µé¢æ•°å­—å±•å¼€åŠŸèƒ½è¯¦ç»†è®¾è®¡**

**1. ä¸»é¡µé¢ï¼ˆindex.htmlï¼‰æ•°å­—å±•å¼€ï¼š**

```html
<!-- ä¸»é¡µKPIæ•°å­—å±•å¼€ç¤ºä¾‹ -->
<div class="kpi-card">
  <div class="kpi-number clickable-number medium-data" 
       onclick="handleNumberClick(this, 'daily_insights', 42, {
         page: 'overview',
         dateRange: 'today',
         category: 'all'
       })">
    42
  </div>
  <div class="kpi-label">ä»Šæ—¥æ–°å¢æ´å¯Ÿ</div>
</div>

<div class="kpi-card">
  <div class="kpi-number clickable-number small-data"
       onclick="handleNumberClick(this, 'processing_tasks', 8, {
         page: 'overview',
         status: 'processing'
       })">
    8
  </div>
  <div class="kpi-label">å¤„ç†ä¸­ä»»åŠ¡</div>
</div>

<div class="kpi-card">
  <div class="kpi-number clickable-number small-data"
       onclick="handleNumberClick(this, 'system_health', 98.2, {
         page: 'overview',
         metric: 'health_score'
       })">
    98.2%
  </div>
  <div class="kpi-label">ç³»ç»Ÿå¥åº·åº¦</div>
</div>
```

**2. æ•°æ®é‡‡é›†é¡µé¢ï¼ˆcollection.htmlï¼‰æ•°å­—å±•å¼€ï¼š**

```html
<!-- æŠ€æœ¯æ•°æ®é‡‡é›†åŒºåŸŸæ•°å­—å±•å¼€ -->
<div class="tech-data-section">
  <div class="data-source-card">
    <div class="card-metrics">
      <div class="metric-item">
        <div class="metric-number clickable-number medium-data"
             onclick="handleNumberClick(this, 'academic_papers_today', 45, {
               page: 'collection',
               source: 'academic_papers',
               dateRange: 'today',
               detailLevel: 'full'
             })">
          45
        </div>
        <div class="metric-label">ä»Šæ—¥é‡‡é›†</div>
      </div>
      
      <div class="metric-item">
        <div class="metric-number clickable-number large-data"
             onclick="handleNumberClick(this, 'academic_papers_total', 1250, {
               page: 'collection',
               source: 'academic_papers',
               dateRange: 'all',
               enablePagination: true,
               pageSize: 25
             })">
          1,250
        </div>
        <div class="metric-label">æ€»è®¡</div>
      </div>
      
      <div class="metric-item">
        <div class="metric-number clickable-number small-data"
             onclick="handleNumberClick(this, 'papers_quality_breakdown', 8.2, {
               page: 'collection',
               source: 'academic_papers',
               metric: 'quality_distribution'
             })">
          8.2
        </div>
        <div class="metric-label">è´¨é‡è¯„åˆ†</div>
      </div>
    </div>
  </div>
</div>

<!-- æ ‡æ†æ•°æ®é‡‡é›†åŒºåŸŸæ•°å­—å±•å¼€ -->
<div class="benchmark-data-section">
  <div class="data-source-card">
    <div class="card-metrics">
      <div class="metric-item">
        <div class="metric-number clickable-number medium-data"
             onclick="handleNumberClick(this, 'industry_dynamics_today', 32, {
               page: 'collection',
               source: 'industry_dynamics',
               dateRange: 'today',
               includeDetails: true
             })">
          32
        </div>
        <div class="metric-label">ä»Šæ—¥åŠ¨æ€</div>
      </div>
      
      <div class="metric-item">
        <div class="metric-number clickable-number small-data"
             onclick="handleNumberClick(this, 'critical_events', 5, {
               page: 'collection',
               source: 'industry_dynamics',
               priority: 'critical',
               showTimeline: true
             })">
          5
        </div>
        <div class="metric-label">é‡è¦äº‹ä»¶</div>
      </div>
    </div>
  </div>
</div>
```

**3. æŠ€æœ¯æ´å¯Ÿé¡µé¢ï¼ˆinsights.htmlï¼‰æ•°å­—å±•å¼€ï¼š**

```html
<!-- æ´å¯Ÿæ¦‚è§ˆæ•°å­—å±•å¼€ -->
<div class="insights-overview">
  <div class="metric-card">
    <div class="metric-number clickable-number large-data"
         onclick="handleNumberClick(this, 'total_insights', 128, {
           page: 'insights',
           category: 'all',
           sortBy: 'date_desc',
           enableFiltering: true
         })">
      128
    </div>
    <div class="metric-label">æ€»æ´å¯Ÿæ•°</div>
  </div>
  
  <div class="metric-card">
    <div class="metric-number clickable-number medium-data"
         onclick="handleNumberClick(this, 'high_value_insights', 23, {
           page: 'insights',
           valueThreshold: 8.0,
           includeAnalysis: true,
           showActionable: true
         })">
      23
    </div>
    <div class="metric-label">é«˜ä»·å€¼æ´å¯Ÿ</div>
  </div>
</div>

<!-- å•†ä¸šä»·å€¼åˆ†ææ•°å­—å±•å¼€ -->
<div id="commercial-panel" class="analysis-panel">
  <div class="roi-metrics">
    <div class="roi-item">
      <div class="roi-number clickable-number small-data"
           onclick="handleNumberClick(this, 'high_roi_projects', 8, {
             page: 'insights',
             analysis: 'commercial',
             roiThreshold: 20,
             showProjectDetails: true
           })">
        8
      </div>
      <div class="roi-label">é«˜ROIé¡¹ç›®</div>
    </div>
    
    <div class="roi-item">
      <div class="roi-number clickable-number small-data"
           onclick="handleNumberClick(this, 'average_roi_breakdown', 15.6, {
             page: 'insights',
             analysis: 'commercial',
             metric: 'roi_distribution',
             showCalculation: true
           })">
        15.6%
      </div>
      <div class="roi-label">å¹³å‡ROI</div>
    </div>
  </div>
</div>

<!-- ç«äº‰æƒ…æŠ¥åˆ†ææ•°å­—å±•å¼€ -->
<div id="competitive-panel" class="analysis-panel">
  <div class="threat-assessment">
    <div class="threat-level-card high">
      <div class="threat-number clickable-number small-data"
           onclick="handleNumberClick(this, 'high_threat_competitors', 3, {
             page: 'insights',
             analysis: 'competitive',
             threatLevel: 'high',
             showCompetitorProfiles: true
           })">
        3
      </div>
      <div class="threat-label">é«˜å¨èƒ</div>
    </div>
  </div>
</div>
```

**4. å†³ç­–è¡ŒåŠ¨é¡µé¢ï¼ˆactions.htmlï¼‰æ•°å­—å±•å¼€ï¼š**

```html
<!-- å†³ç­–ä»ªè¡¨æ¿æ•°å­—å±•å¼€ -->
<div class="decision-dashboard">
  <div class="metric-card investment">
    <div class="metric-number clickable-number medium-data"
         onclick="handleNumberClick(this, 'investment_opportunities', 25, {
           page: 'actions',
           category: 'opportunities',
           enableGrading: true,
           showROIProjection: true
         })">
      25
    </div>
    <div class="metric-label">æŠ•èµ„æœºä¼š</div>
  </div>
  
  <div class="metric-card actions">
    <div class="metric-number clickable-number medium-data"
         onclick="handleNumberClick(this, 'pending_actions', 12, {
           page: 'actions',
           status: 'pending',
           enableStatusUpdate: true,
           showPriorityFilter: true
         })">
      12
    </div>
    <div class="metric-label">å¾…æ‰§è¡Œè¡ŒåŠ¨</div>
  </div>
</div>

<!-- æŠ•èµ„æœºä¼šè¯„çº§æ•°å­—å±•å¼€ -->
<div class="investment-opportunities">
  <div class="level-card grade-a">
    <div class="grade-number clickable-number small-data"
         onclick="handleNumberClick(this, 'grade_a_opportunities', 5, {
           page: 'actions',
           grade: 'A',
           showDetailedAnalysis: true,
           enableActionInput: true
         })">
      5
    </div>
    <div class="grade-label">é«˜ä»·å€¼æœºä¼š</div>
  </div>
</div>
```

**5. æŠ¥å‘Šé¡µé¢ï¼ˆreports.htmlï¼‰æ•°å­—å±•å¼€ï¼š**

```html
<!-- æŠ¥å‘Šç»Ÿè®¡æ•°å­—å±•å¼€ -->
<div class="reports-stats">
  <div class="stat-card">
    <div class="stat-number clickable-number medium-data"
         onclick="handleNumberClick(this, 'daily_reports', 30, {
           page: 'reports',
           reportType: 'daily',
           dateRange: 'last_30_days',
           enableSearch: true
         })">
      30
    </div>
    <div class="stat-label">æ—¥æŠ¥</div>
  </div>
  
  <div class="stat-card">
    <div class="stat-number clickable-number small-data"
         onclick="handleNumberClick(this, 'weekly_reports', 4, {
           page: 'reports',
           reportType: 'weekly',
           showContent: true,
           enableDownload: true
         })">
      4
    </div>
    <div class="stat-label">å‘¨æŠ¥</div>
  </div>
</div>
```

---

**é«˜ä»·å€¼çº¿ç´¢è¡ŒåŠ¨è¾“å…¥åŠŸèƒ½è®¾è®¡**

**é«˜ä»·å€¼çº¿ç´¢è¡ŒåŠ¨ç®¡ç†ç•Œé¢ï¼š**

```html
<!-- é«˜ä»·å€¼çº¿ç´¢è¯¦æƒ…å¼¹çª— -->
<div id="highValueInsightModal" class="modal large-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="insightTitle">é«˜ä»·å€¼çº¿ç´¢è¯¦æƒ…</h3>
      <span class="close">&times;</span>
    </div>
    
    <div class="modal-body">
      <!-- çº¿ç´¢åŸºæœ¬ä¿¡æ¯ -->
      <div class="insight-basic-info">
        <div class="info-grid">
          <div class="info-item">
            <label>çº¿ç´¢ID:</label>
            <span id="insightId">TI20250624001</span>
          </div>
          <div class="info-item">
            <label>å‘ç°æ—¶é—´:</label>
            <span id="discoveryTime">2025-06-24 09:30:00</span>
          </div>
          <div class="info-item">
            <label>ä»·å€¼è¯„åˆ†:</label>
            <span id="valueScore" class="score-high">9.2/10</span>
          </div>
          <div class="info-item">
            <label>å½“å‰çŠ¶æ€:</label>
            <span id="currentStatus" class="status-pending">å¾…è¡ŒåŠ¨</span>
          </div>
        </div>
      </div>
      
      <!-- çº¿ç´¢è¯¦ç»†å†…å®¹ -->
      <div class="insight-content">
        <h4>çº¿ç´¢å†…å®¹</h4>
        <div id="insightContent" class="content-display">
          <!-- åŠ¨æ€åŠ è½½çº¿ç´¢è¯¦ç»†å†…å®¹ -->
        </div>
      </div>
      
      <!-- åˆ†æç»“æœ -->
      <div class="analysis-results">
        <div class="analysis-tabs">
          <div class="tab active" data-tab="commercial">å•†ä¸šåˆ†æ</div>
          <div class="tab" data-tab="technical">æŠ€æœ¯åˆ†æ</div>
          <div class="tab" data-tab="competitive">ç«äº‰åˆ†æ</div>
        </div>
        <div class="analysis-content" id="analysisContent">
          <!-- åŠ¨æ€åŠ è½½åˆ†æå†…å®¹ -->
        </div>
      </div>
      
      <!-- å†å²è¡ŒåŠ¨è®°å½• -->
      <div class="action-history">
        <h4>å†å²è¡ŒåŠ¨è®°å½•</h4>
        <div id="actionHistory" class="history-timeline">
          <!-- åŠ¨æ€åŠ è½½å†å²è®°å½• -->
        </div>
      </div>
      
      <!-- ä¸‹ä¸€æ­¥è¡ŒåŠ¨è¾“å…¥åŒºåŸŸ -->
      <div class="next-action-section">
        <h4>ä¸‹ä¸€æ­¥è¡ŒåŠ¨è§„åˆ’</h4>
        
        <form id="nextActionForm" class="action-form">
          <div class="form-group">
            <label for="actionType">è¡ŒåŠ¨ç±»å‹:</label>
            <select id="actionType" name="actionType" required>
              <option value="">è¯·é€‰æ‹©è¡ŒåŠ¨ç±»å‹</option>
              <option value="investment">æŠ•èµ„å†³ç­–</option>
              <option value="research">æ·±å…¥ç ”ç©¶</option>
              <option value="partnership">å¯»æ±‚åˆä½œ</option>
              <option value="monitoring">æŒç»­ç›‘æ§</option>
              <option value="prototype">åŸå‹å¼€å‘</option>
              <option value="market_analysis">å¸‚åœºåˆ†æ</option>
              <option value="competitive_response">ç«äº‰åº”å¯¹</option>
              <option value="other">å…¶ä»–</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="actionPriority">ä¼˜å…ˆçº§:</label>
            <select id="actionPriority" name="actionPriority" required>
              <option value="">è¯·é€‰æ‹©ä¼˜å…ˆçº§</option>
              <option value="urgent">ç´§æ€¥</option>
              <option value="high">é«˜</option>
              <option value="medium">ä¸­</option>
              <option value="low">ä½</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="actionDescription">è¡ŒåŠ¨æè¿°:</label>
            <textarea id="actionDescription" name="actionDescription" 
                      rows="4" placeholder="è¯·è¯¦ç»†æè¿°ä¸‹ä¸€æ­¥å…·ä½“è¡ŒåŠ¨è®¡åˆ’..." required></textarea>
          </div>
          
          <div class="form-group">
            <label for="expectedOutcome">é¢„æœŸç»“æœ:</label>
            <textarea id="expectedOutcome" name="expectedOutcome" 
                      rows="3" placeholder="æè¿°é¢„æœŸè¾¾æˆçš„ç»“æœå’Œç›®æ ‡..."></textarea>
          </div>
          
          <div class="form-group">
            <label for="estimatedBudget">é¢„ä¼°é¢„ç®—:</label>
            <div class="budget-input">
              <select id="budgetCurrency" name="budgetCurrency">
                <option value="USD">USD</option>
                <option value="CNY">CNY</option>
                <option value="EUR">EUR</option>
              </select>
              <input type="number" id="estimatedBudget" name="estimatedBudget" 
                     placeholder="0" min="0" step="1000">
            </div>
          </div>
          
          <div class="form-group">
            <label for="targetDate">ç›®æ ‡å®Œæˆæ—¥æœŸ:</label>
            <input type="date" id="targetDate" name="targetDate" required>
          </div>
          
          <div class="form-group">
            <label for="assignedTo">è´Ÿè´£äºº:</label>
            <input type="text" id="assignedTo" name="assignedTo" 
                   placeholder="è¾“å…¥è´Ÿè´£äººå§“åæˆ–é‚®ç®±">
          </div>
          
          <div class="form-group">
            <label for="keyMilestones">å…³é”®é‡Œç¨‹ç¢‘:</label>
            <div id="milestonesContainer">
              <div class="milestone-item">
                <input type="text" name="milestone[]" placeholder="é‡Œç¨‹ç¢‘æè¿°">
                <input type="date" name="milestoneDate[]">
                <button type="button" onclick="removeMilestone(this)">åˆ é™¤</button>
              </div>
            </div>
            <button type="button" onclick="addMilestone()">æ·»åŠ é‡Œç¨‹ç¢‘</button>
          </div>
          
          <div class="form-group">
            <label for="riskAssessment">é£é™©è¯„ä¼°:</label>
            <textarea id="riskAssessment" name="riskAssessment" 
                      rows="3" placeholder="è¯†åˆ«å¯èƒ½çš„é£é™©å’Œåº”å¯¹æªæ–½..."></textarea>
          </div>
          
          <div class="form-group">
            <label for="successMetrics">æˆåŠŸæŒ‡æ ‡:</label>
            <textarea id="successMetrics" name="successMetrics" 
                      rows="2" placeholder="å®šä¹‰è¡¡é‡æˆåŠŸçš„å…·ä½“æŒ‡æ ‡..."></textarea>
          </div>
          
          <div class="form-actions">
            <button type="button" onclick="saveAsDraft()">ä¿å­˜è‰ç¨¿</button>
            <button type="submit">æäº¤è¡ŒåŠ¨è®¡åˆ’</button>
            <button type="button" onclick="closeModal()">å–æ¶ˆ</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
```

**è¡ŒåŠ¨è¾“å…¥çš„JavaScriptå¤„ç†é€»è¾‘ï¼š**

```javascript
// é«˜ä»·å€¼çº¿ç´¢è¡ŒåŠ¨ç®¡ç†ç±»
class HighValueInsightActionManager {
  
  constructor() {
    this.currentInsightId = null;
    this.formValidator = new FormValidator();
  }
  
  // æ˜¾ç¤ºé«˜ä»·å€¼çº¿ç´¢è¯¦æƒ…å’Œè¡ŒåŠ¨è¾“å…¥ç•Œé¢
  showInsightActionModal(insightId) {
    this.currentInsightId = insightId;
    
    // åŠ è½½çº¿ç´¢è¯¦æƒ…
    google.script.run
      .withSuccessHandler(data => this.renderInsightDetails(data))
      .withFailureHandler(error => this.handleError(error))
      .getHighValueInsightDetails(insightId);
    
    // æ˜¾ç¤ºæ¨¡æ€æ¡†
    document.getElementById('highValueInsightModal').style.display = 'block';
  }
  
  // æ¸²æŸ“çº¿ç´¢è¯¦æƒ…
  renderInsightDetails(data) {
    document.getElementById('insightId').textContent = data.insightId;
    document.getElementById('discoveryTime').textContent = data.discoveryTime;
    document.getElementById('valueScore').textContent = `${data.valueScore}/10`;
    document.getElementById('currentStatus').textContent = data.currentStatus;
    document.getElementById('insightContent').innerHTML = data.content;
    
    // æ¸²æŸ“åˆ†æç»“æœ
    this.renderAnalysisResults(data.analysisResults);
    
    // æ¸²æŸ“å†å²è¡ŒåŠ¨è®°å½•
    this.renderActionHistory(data.actionHistory);
    
    // é¢„å¡«å……è¡¨å•ï¼ˆå¦‚æœæœ‰è‰ç¨¿ï¼‰
    if (data.draftAction) {
      this.populateForm(data.draftAction);
    }
  }
  
  // æäº¤è¡ŒåŠ¨è®¡åˆ’
  submitActionPlan(formData) {
    // è¡¨å•éªŒè¯
    if (!this.formValidator.validate(formData)) {
      return;
    }
    
    // æ˜¾ç¤ºæäº¤çŠ¶æ€
    this.showSubmitStatus('submitting');
    
    // å‡†å¤‡æäº¤æ•°æ®
    const actionData = {
      insightId: this.currentInsightId,
      actionType: formData.actionType,
      priority: formData.actionPriority,
      description: formData.actionDescription,
      expectedOutcome: formData.expectedOutcome,
      estimatedBudget: {
        amount: formData.estimatedBudget,
        currency: formData.budgetCurrency
      },
      targetDate: formData.targetDate,
      assignedTo: formData.assignedTo,
      milestones: this.parseMilestones(formData),
      riskAssessment: formData.riskAssessment,
      successMetrics: formData.successMetrics,
      createdBy: Session.getActiveUser().getEmail(),
      createdAt: new Date().toISOString(),
      status: 'planned'
    };
    
    // æäº¤åˆ°åç«¯
    google.script.run
      .withSuccessHandler(result => this.handleSubmitSuccess(result))
      .withFailureHandler(error => this.handleSubmitError(error))
      .saveHighValueInsightAction(actionData);
  }
  
  // ä¿å­˜è‰ç¨¿
  saveAsDraft() {
    const formData = this.getFormData();
    const draftData = {
      insightId: this.currentInsightId,
      formData: formData,
      savedAt: new Date().toISOString()
    };
    
    google.script.run
      .withSuccessHandler(() => this.showMessage('è‰ç¨¿å·²ä¿å­˜', 'success'))
      .withFailureHandler(error => this.showMessage('ä¿å­˜è‰ç¨¿å¤±è´¥', 'error'))
      .saveDraftAction(draftData);
  }
  
  // æ·»åŠ é‡Œç¨‹ç¢‘
  addMilestone() {
    const container = document.getElementById('milestonesContainer');
    const milestoneItem = document.createElement('div');
    milestoneItem.className = 'milestone-item';
    milestoneItem.innerHTML = `
      <input type="text" name="milestone[]" placeholder="é‡Œç¨‹ç¢‘æè¿°">
      <input type="date" name="milestoneDate[]">
      <button type="button" onclick="removeMilestone(this)">åˆ é™¤</button>
    `;
    container.appendChild(milestoneItem);
  }
  
  // åˆ é™¤é‡Œç¨‹ç¢‘
  removeMilestone(button) {
    button.parentElement.remove();
  }
  
  // è·å–è¡¨å•æ•°æ®
  getFormData() {
    const form = document.getElementById('nextActionForm');
    const formData = new FormData(form);
    const data = {};
    
    for (let [key, value] of formData.entries()) {
      if (key.endsWith('[]')) {
        const arrayKey = key.slice(0, -2);
        if (!data[arrayKey]) data[arrayKey] = [];
        data[arrayKey].push(value);
      } else {
        data[key] = value;
      }
    }
    
    return data;
  }
  
  // å¤„ç†æäº¤æˆåŠŸ
  handleSubmitSuccess(result) {
    this.showSubmitStatus('success');
    this.showMessage('è¡ŒåŠ¨è®¡åˆ’æäº¤æˆåŠŸï¼', 'success');
    
    // æ›´æ–°çº¿ç´¢çŠ¶æ€
    this.updateInsightStatus(result.insightId, 'action_planned');
    
    // æ¸…ç©ºè¡¨å•
    document.getElementById('nextActionForm').reset();
    
    // åˆ·æ–°ç›¸å…³æ•°æ®
    this.refreshActionData();
    
    // 3ç§’åå…³é—­æ¨¡æ€æ¡†
    setTimeout(() => {
      this.closeModal();
    }, 3000);
  }
  
  // å¤„ç†æäº¤é”™è¯¯
  handleSubmitError(error) {
    this.showSubmitStatus('error');
    this.showMessage(`æäº¤å¤±è´¥: ${error.message}`, 'error');
  }
}

// è¡¨å•éªŒè¯å™¨
class FormValidator {
  validate(formData) {
    const errors = [];
    
    // å¿…å¡«å­—æ®µéªŒè¯
    if (!formData.actionType) errors.push('è¯·é€‰æ‹©è¡ŒåŠ¨ç±»å‹');
    if (!formData.actionPriority) errors.push('è¯·é€‰æ‹©ä¼˜å…ˆçº§');
    if (!formData.actionDescription) errors.push('è¯·å¡«å†™è¡ŒåŠ¨æè¿°');
    if (!formData.targetDate) errors.push('è¯·é€‰æ‹©ç›®æ ‡å®Œæˆæ—¥æœŸ');
    
    // æ—¥æœŸéªŒè¯
    if (formData.targetDate && new Date(formData.targetDate) <= new Date()) {
      errors.push('ç›®æ ‡å®Œæˆæ—¥æœŸå¿…é¡»æ˜¯æœªæ¥æ—¥æœŸ');
    }
    
    // é¢„ç®—éªŒè¯
    if (formData.estimatedBudget && formData.estimatedBudget < 0) {
      errors.push('é¢„ä¼°é¢„ç®—ä¸èƒ½ä¸ºè´Ÿæ•°');
    }
    
    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    if (errors.length > 0) {
      this.showValidationErrors(errors);
      return false;
    }
    
    return true;
  }
  
  showValidationErrors(errors) {
    const errorContainer = document.createElement('div');
    errorContainer.className = 'validation-errors';
    errorContainer.innerHTML = `
      <h4>è¯·ä¿®æ­£ä»¥ä¸‹é”™è¯¯ï¼š</h4>
      <ul>
        ${errors.map(error => `<li>${error}</li>`).join('')}
      </ul>
    `;
    
    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    const form = document.getElementById('nextActionForm');
    form.insertBefore(errorContainer, form.firstChild);
    
    // 3ç§’åè‡ªåŠ¨éšè—
    setTimeout(() => {
      errorContainer.remove();
    }, 5000);
  }
}

// åˆå§‹åŒ–è¡ŒåŠ¨ç®¡ç†å™¨
const insightActionManager = new HighValueInsightActionManager();

// è¡¨å•æäº¤äº‹ä»¶å¤„ç†
document.getElementById('nextActionForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const formData = insightActionManager.getFormData();
  insightActionManager.submitActionPlan(formData);
});
```

**åç«¯æ•°æ®åº“å†™å…¥æœåŠ¡ï¼š**

```javascript
// Google Apps Script åç«¯æœåŠ¡
function saveHighValueInsightAction(actionData) {
  try {
    // è·å–è¡ŒåŠ¨å»ºè®®è¡¨
    const actionSheet = SpreadsheetApp.openById(ACTION_RECOMMENDATIONS_SHEET_ID)
                                    .getSheetByName('Action_Recommendations');
    
    // ç”Ÿæˆè¡ŒåŠ¨ID
    const actionId = generateActionId();
    
    // å‡†å¤‡å†™å…¥æ•°æ®
    const rowData = [
      actionId,                           // action_id
      actionData.insightId,              // related_insight_id
      actionData.actionType,             // action_type
      actionData.priority,               // priority
      actionData.description,            // description
      actionData.expectedOutcome,        // expected_outcome
      actionData.estimatedBudget.amount, // estimated_budget
      actionData.estimatedBudget.currency, // budget_currency
      actionData.targetDate,             // target_date
      actionData.assignedTo,             // assigned_to
      JSON.stringify(actionData.milestones), // milestones
      actionData.riskAssessment,         // risk_assessment
      actionData.successMetrics,         // success_metrics
      actionData.status,                 // status
      actionData.createdBy,              // created_by
      actionData.createdAt,              // created_at
      '',                                // updated_at
      '',                                // completed_at
      ''                                 // notes
    ];
    
    // å†™å…¥æ•°æ®
    actionSheet.appendRow(rowData);
    
    // æ›´æ–°ç›¸å…³æ´å¯Ÿçš„çŠ¶æ€
    updateInsightActionStatus(actionData.insightId, actionId, 'action_planned');
    
    // å‘é€é€šçŸ¥ï¼ˆå¦‚æœæŒ‡å®šäº†è´Ÿè´£äººï¼‰
    if (actionData.assignedTo) {
      sendActionAssignmentNotification(actionData);
    }
    
    return {
      success: true,
      actionId: actionId,
      insightId: actionData.insightId,
      message: 'è¡ŒåŠ¨è®¡åˆ’ä¿å­˜æˆåŠŸ'
    };
    
  } catch (error) {
    console.error('ä¿å­˜è¡ŒåŠ¨è®¡åˆ’å¤±è´¥:', error);
    throw new Error(`ä¿å­˜å¤±è´¥: ${error.message}`);
  }
}

// æ›´æ–°æ´å¯ŸçŠ¶æ€
function updateInsightActionStatus(insightId, actionId, status) {
  try {
    // è·å–æŠ€æœ¯æ´å¯Ÿä¸»è¡¨
    const masterSheet = SpreadsheetApp.openById(TECH_INTELLIGENCE_MASTER_SHEET_ID)
                                     .getSheetByName('Tech_Intelligence_Master');
    
    const data = masterSheet.getDataRange().getValues();
    const headers = data[0];
    const insightIdCol = headers.indexOf('intelligence_id');
    const actionStatusCol = headers.indexOf('action_status');
    const linkedActionCol = headers.indexOf('linked_action_id');
    const lastUpdateCol = headers.indexOf('last_update_timestamp');
    
    // æŸ¥æ‰¾å¯¹åº”çš„æ´å¯Ÿè®°å½•
    for (let i = 1; i < data.length; i++) {
      if (data[i][insightIdCol] === insightId) {
        // æ›´æ–°çŠ¶æ€
        masterSheet.getRange(i + 1, actionStatusCol + 1).setValue(status);
        masterSheet.getRange(i + 1, linkedActionCol + 1).setValue(actionId);
        masterSheet.getRange(i + 1, lastUpdateCol + 1).setValue(new Date().toISOString());
        break;
      }
    }
    
    return true;
  } catch (error) {
    console.error('æ›´æ–°æ´å¯ŸçŠ¶æ€å¤±è´¥:', error);
    throw error;
  }
}

// ç”Ÿæˆè¡ŒåŠ¨ID
function generateActionId() {
  const timestamp = new Date().toISOString().replace(/[-:T.]/g, '').substring(0, 14);
  const random = Math.random().toString(36).substring(2, 6).toUpperCase();
  return `ACT${timestamp}${random}`;
}

// ä¿å­˜è‰ç¨¿è¡ŒåŠ¨
function saveDraftAction(draftData) {
  try {
    // è·å–è‰ç¨¿å­˜å‚¨è¡¨ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰
    const draftSheet = getOrCreateDraftSheet();
    
    const rowData = [
      draftData.insightId,
      JSON.stringify(draftData.formData),
      draftData.savedAt,
      Session.getActiveUser().getEmail()
    ];
    
    // æ£€æŸ¥æ˜¯å¦å·²æœ‰è‰ç¨¿
    const existingDraftRow = findExistingDraft(draftSheet, draftData.insightId);
    
    if (existingDraftRow > 0) {
      // æ›´æ–°ç°æœ‰è‰ç¨¿
      draftSheet.getRange(existingDraftRow, 1, 1, rowData.length).setValues([rowData]);
    } else {
      // åˆ›å»ºæ–°è‰ç¨¿
      draftSheet.appendRow(rowData);
    }
    
    return { success: true, message: 'è‰ç¨¿ä¿å­˜æˆåŠŸ' };
  } catch (error) {
    console.error('ä¿å­˜è‰ç¨¿å¤±è´¥:', error);
    throw new Error(`ä¿å­˜è‰ç¨¿å¤±è´¥: ${error.message}`);
  }
}

// è·å–æˆ–åˆ›å»ºè‰ç¨¿è¡¨
function getOrCreateDraftSheet() {
  const spreadsheet = SpreadsheetApp.openById(ACTION_RECOMMENDATIONS_SHEET_ID);
  let draftSheet = spreadsheet.getSheetByName('Action_Drafts');
  
  if (!draftSheet) {
    draftSheet = spreadsheet.insertSheet('Action_Drafts');
    const headers = ['insight_id', 'draft_data', 'saved_at', 'saved_by'];
    draftSheet.getRange(1, 1, 1, headers.length).setValues([headers]);
  }
  
  return draftSheet;
}

// æŸ¥æ‰¾ç°æœ‰è‰ç¨¿
function findExistingDraft(draftSheet, insightId) {
  const data = draftSheet.getDataRange().getValues();
  for (let i = 1; i < data.length; i++) {
    if (data[i][0] === insightId) {
      return i + 1; // è¿”å›è¡Œå·ï¼ˆ1-basedï¼‰
    }
  }
  return 0; // æœªæ‰¾åˆ°
}

// å‘é€è¡ŒåŠ¨åˆ†é…é€šçŸ¥
function sendActionAssignmentNotification(actionData) {
  try {
    const emailSubject = `æ–°çš„è¡ŒåŠ¨è®¡åˆ’åˆ†é… - ${actionData.insightId}`;
    const emailBody = `
      æ‚¨å¥½ï¼Œ
      
      æ‚¨è¢«åˆ†é…äº†ä¸€ä¸ªæ–°çš„è¡ŒåŠ¨è®¡åˆ’ï¼š
      
      æ´å¯ŸID: ${actionData.insightId}
      è¡ŒåŠ¨ç±»å‹: ${actionData.actionType}
      ä¼˜å…ˆçº§: ${actionData.priority}
      ç›®æ ‡å®Œæˆæ—¥æœŸ: ${actionData.targetDate}
      
      è¡ŒåŠ¨æè¿°:
      ${actionData.description}
      
      é¢„æœŸç»“æœ:
      ${actionData.expectedOutcome}
      
      è¯·ç™»å½•ç³»ç»ŸæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯å¹¶å¼€å§‹æ‰§è¡Œã€‚
      
      æŠ€æœ¯æ´å¯Ÿåˆ†æå¼•æ“
      ${new Date().toLocaleString()}
    `;
    
    // å‘é€é‚®ä»¶é€šçŸ¥
    GmailApp.sendEmail(actionData.assignedTo, emailSubject, emailBody);
    
    // è®°å½•é€šçŸ¥æ—¥å¿—
    logNotification('action_assignment', actionData.assignedTo, actionData.insightId);
    
  } catch (error) {
    console.error('å‘é€é€šçŸ¥å¤±è´¥:', error);
    // é€šçŸ¥å¤±è´¥ä¸åº”è¯¥å½±å“ä¸»æµç¨‹ï¼Œåªè®°å½•é”™è¯¯
  }
}
```

**è¡ŒåŠ¨è¿›åº¦è·Ÿè¸ªå’Œæ›´æ–°åŠŸèƒ½ï¼š**

```html
<!-- è¡ŒåŠ¨è¿›åº¦æ›´æ–°ç•Œé¢ -->
<div id="actionProgressModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>è¡ŒåŠ¨è¿›åº¦æ›´æ–°</h3>
      <span class="close">&times;</span>
    </div>
    
    <div class="modal-body">
      <div class="action-summary">
        <h4 id="actionTitle">è¡ŒåŠ¨è®¡åˆ’æ¦‚è¦</h4>
        <div class="summary-grid">
          <div class="summary-item">
            <label>è¡ŒåŠ¨ID:</label>
            <span id="actionId"></span>
          </div>
          <div class="summary-item">
            <label>å…³è”æ´å¯Ÿ:</label>
            <span id="relatedInsight"></span>
          </div>
          <div class="summary-item">
            <label>å½“å‰çŠ¶æ€:</label>
            <span id="currentActionStatus"></span>
          </div>
          <div class="summary-item">
            <label>è¿›åº¦:</label>
            <div class="progress-bar">
              <div id="progressFill" class="progress-fill"></div>
              <span id="progressText">0%</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="progress-update-form">
        <h4>è¿›åº¦æ›´æ–°</h4>
        <form id="progressUpdateForm">
          <div class="form-group">
            <label for="progressPercentage">å®Œæˆè¿›åº¦ (%):</label>
            <input type="range" id="progressPercentage" name="progressPercentage" 
                   min="0" max="100" step="5" 
                   oninput="updateProgressDisplay(this.value)">
            <span id="progressValue">0%</span>
          </div>
          
          <div class="form-group">
            <label for="statusUpdate">çŠ¶æ€æ›´æ–°:</label>
            <select id="statusUpdate" name="statusUpdate">
              <option value="planned">è®¡åˆ’ä¸­</option>
              <option value="in_progress">æ‰§è¡Œä¸­</option>
              <option value="on_hold">æš‚åœ</option>
              <option value="completed">å·²å®Œæˆ</option>
              <option value="cancelled">å·²å–æ¶ˆ</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="progressNotes">è¿›åº¦è¯´æ˜:</label>
            <textarea id="progressNotes" name="progressNotes" rows="4" 
                      placeholder="æè¿°å½“å‰è¿›å±•ã€é‡åˆ°çš„é—®é¢˜æˆ–ä¸‹ä¸€æ­¥è®¡åˆ’..."></textarea>
          </div>
          
          <div class="form-group">
            <label for="milestonesUpdate">é‡Œç¨‹ç¢‘æ›´æ–°:</label>
            <div id="milestonesProgress">
              <!-- åŠ¨æ€åŠ è½½é‡Œç¨‹ç¢‘è¿›åº¦ -->
            </div>
          </div>
          
          <div class="form-group">
            <label for="budgetSpent">å·²ç”¨é¢„ç®—:</label>
            <div class="budget-input">
              <input type="number" id="budgetSpent" name="budgetSpent" 
                     placeholder="0" min="0" step="100">
              <span id="budgetCurrency">USD</span>
            </div>
          </div>
          
          <div class="form-group">
            <label for="nextSteps">ä¸‹ä¸€æ­¥è®¡åˆ’:</label>
            <textarea id="nextSteps" name="nextSteps" rows="3" 
                      placeholder="æè¿°æ¥ä¸‹æ¥çš„å…·ä½“è¡ŒåŠ¨è®¡åˆ’..."></textarea>
          </div>
          
          <div class="form-group">
            <label for="risksIssues">é£é™©å’Œé—®é¢˜:</label>
            <textarea id="risksIssues" name="risksIssues" rows="3" 
                      placeholder="æè¿°é‡åˆ°çš„é£é™©ã€é—®é¢˜æˆ–éœ€è¦æ”¯æŒçš„åœ°æ–¹..."></textarea>
          </div>
          
          <div class="form-group">
            <label for="attachments">ç›¸å…³é™„ä»¶:</label>
            <input type="file" id="attachments" name="attachments" multiple 
                   accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.png">
            <div class="file-upload-hint">æ”¯æŒä¸Šä¼ æ–‡æ¡£ã€å›¾ç‰‡ç­‰ç›¸å…³æ–‡ä»¶</div>
          </div>
          
          <div class="form-actions">
            <button type="submit">æ›´æ–°è¿›åº¦</button>
            <button type="button" onclick="closeProgressModal()">å–æ¶ˆ</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
```

**è¡ŒåŠ¨è¿›åº¦ç®¡ç†JavaScriptï¼š**

```javascript
// è¡ŒåŠ¨è¿›åº¦ç®¡ç†ç±»
class ActionProgressManager {
  
  constructor() {
    this.currentActionId = null;
  }
  
  // æ˜¾ç¤ºè¿›åº¦æ›´æ–°ç•Œé¢
  showProgressUpdateModal(actionId) {
    this.currentActionId = actionId;
    
    // åŠ è½½è¡ŒåŠ¨è¯¦æƒ…å’Œå½“å‰è¿›åº¦
    google.script.run
      .withSuccessHandler(data => this.renderProgressModal(data))
      .withFailureHandler(error => this.handleError(error))
      .getActionProgressDetails(actionId);
    
    document.getElementById('actionProgressModal').style.display = 'block';
  }
  
  // æ¸²æŸ“è¿›åº¦æ¨¡æ€æ¡†
  renderProgressModal(data) {
    document.getElementById('actionId').textContent = data.actionId;
    document.getElementById('relatedInsight').textContent = data.relatedInsightId;
    document.getElementById('currentActionStatus').textContent = data.currentStatus;
    
    // æ›´æ–°è¿›åº¦æ¡
    this.updateProgressBar(data.currentProgress);
    
    // é¢„å¡«å……è¡¨å•
    document.getElementById('progressPercentage').value = data.currentProgress;
    document.getElementById('statusUpdate').value = data.currentStatus;
    document.getElementById('budgetSpent').value = data.budgetSpent || 0;
    document.getElementById('budgetCurrency').textContent = data.budgetCurrency;
    
    // æ¸²æŸ“é‡Œç¨‹ç¢‘è¿›åº¦
    this.renderMilestonesProgress(data.milestones);
  }
  
  // æ›´æ–°è¿›åº¦æ˜¾ç¤º
  updateProgressDisplay(value) {
    document.getElementById('progressValue').textContent = value + '%';
    this.updateProgressBar(value);
  }
  
  // æ›´æ–°è¿›åº¦æ¡
  updateProgressBar(percentage) {
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');
    
    progressFill.style.width = percentage + '%';
    progressText.textContent = percentage + '%';
    
    // æ ¹æ®è¿›åº¦æ”¹å˜é¢œè‰²
    if (percentage < 30) {
      progressFill.className = 'progress-fill low';
    } else if (percentage < 70) {
      progressFill.className = 'progress-fill medium';
    } else {
      progressFill.className = 'progress-fill high';
    }
  }
  
  // æ¸²æŸ“é‡Œç¨‹ç¢‘è¿›åº¦
  renderMilestonesProgress(milestones) {
    const container = document.getElementById('milestonesProgress');
    container.innerHTML = '';
    
    milestones.forEach((milestone, index) => {
      const milestoneDiv = document.createElement('div');
      milestoneDiv.className = 'milestone-progress-item';
      milestoneDiv.innerHTML = `
        <div class="milestone-info">
          <span class="milestone-name">${milestone.name}</span>
          <span class="milestone-date">${milestone.date}</span>
        </div>
        <div class="milestone-status">
          <select name="milestoneStatus[]" data-milestone-index="${index}">
            <option value="pending" ${milestone.status === 'pending' ? 'selected' : ''}>å¾…å¼€å§‹</option>
            <option value="in_progress" ${milestone.status === 'in_progress' ? 'selected' : ''}>è¿›è¡Œä¸­</option>
            <option value="completed" ${milestone.status === 'completed' ? 'selected' : ''}>å·²å®Œæˆ</option>
            <option value="delayed" ${milestone.status === 'delayed' ? 'selected' : ''}>å»¶æœŸ</option>
          </select>
        </div>
      `;
      container.appendChild(milestoneDiv);
    });
  }
  
  // æäº¤è¿›åº¦æ›´æ–°
  submitProgressUpdate(formData) {
    const progressData = {
      actionId: this.currentActionId,
      progressPercentage: formData.progressPercentage,
      statusUpdate: formData.statusUpdate,
      progressNotes: formData.progressNotes,
      budgetSpent: formData.budgetSpent,
      nextSteps: formData.nextSteps,
      risksIssues: formData.risksIssues,
      milestonesStatus: this.getMilestonesStatus(),
      updatedBy: Session.getActiveUser().getEmail(),
      updatedAt: new Date().toISOString()
    };
    
    // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
    const attachments = document.getElementById('attachments').files;
    if (attachments.length > 0) {
      this.uploadAttachments(attachments, progressData);
    } else {
      this.saveProgressUpdate(progressData);
    }
  }
  
  // è·å–é‡Œç¨‹ç¢‘çŠ¶æ€
  getMilestonesStatus() {
    const milestoneSelects = document.querySelectorAll('select[name="milestoneStatus[]"]');
    const milestonesStatus = [];
    
    milestoneSelects.forEach(select => {
      milestonesStatus.push({
        index: select.dataset.milestoneIndex,
        status: select.value
      });
    });
    
    return milestonesStatus;
  }
  
  // ä¿å­˜è¿›åº¦æ›´æ–°
  saveProgressUpdate(progressData) {
    google.script.run
      .withSuccessHandler(result => this.handleUpdateSuccess(result))
      .withFailureHandler(error => this.handleUpdateError(error))
      .updateActionProgress(progressData);
  }
  
  // å¤„ç†æ›´æ–°æˆåŠŸ
  handleUpdateSuccess(result) {
    this.showMessage('è¿›åº¦æ›´æ–°æˆåŠŸï¼', 'success');
    
    // åˆ·æ–°ç›¸å…³æ•°æ®æ˜¾ç¤º
    this.refreshActionData();
    
    // å…³é—­æ¨¡æ€æ¡†
    setTimeout(() => {
      this.closeModal();
    }, 2000);
  }
  
  // å¤„ç†æ›´æ–°é”™è¯¯
  handleUpdateError(error) {
    this.showMessage(`æ›´æ–°å¤±è´¥: ${error.message}`, 'error');
  }
}

// åˆå§‹åŒ–è¿›åº¦ç®¡ç†å™¨
const actionProgressManager = new ActionProgressManager();

// è¿›åº¦æ›´æ–°è¡¨å•æäº¤å¤„ç†
document.getElementById('progressUpdateForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const formData = new FormData(this);
  const data = Object.fromEntries(formData.entries());
  actionProgressManager.submitProgressUpdate(data);
});
```

**åç«¯è¿›åº¦æ›´æ–°æœåŠ¡ï¼š**

```javascript
// æ›´æ–°è¡ŒåŠ¨è¿›åº¦
function updateActionProgress(progressData) {
  try {
    // è·å–è¡ŒåŠ¨å»ºè®®è¡¨
    const actionSheet = SpreadsheetApp.openById(ACTION_RECOMMENDATIONS_SHEET_ID)
                                    .getSheetByName('Action_Recommendations');
    
    const data = actionSheet.getDataRange().getValues();
    const headers = data[0];
    
    // æŸ¥æ‰¾å¯¹åº”çš„è¡ŒåŠ¨è®°å½•
    const actionIdCol = headers.indexOf('action_id');
    let targetRow = -1;
    
    for (let i = 1; i < data.length; i++) {
      if (data[i][actionIdCol] === progressData.actionId) {
        targetRow = i + 1;
        break;
      }
    }
    
    if (targetRow === -1) {
      throw new Error('æœªæ‰¾åˆ°å¯¹åº”çš„è¡ŒåŠ¨è®°å½•');
    }
    
    // æ›´æ–°è¿›åº¦ç›¸å…³å­—æ®µ
    const progressCol = headers.indexOf('progress_percentage');
    const statusCol = headers.indexOf('status');
    const notesCol = headers.indexOf('progress_notes');
    const budgetSpentCol = headers.indexOf('budget_spent');
    const updatedAtCol = headers.indexOf('updated_at');
    const updatedByCol = headers.indexOf('updated_by');
    
    actionSheet.getRange(targetRow, progressCol + 1).setValue(progressData.progressPercentage);
    actionSheet.getRange(targetRow, statusCol + 1).setValue(progressData.statusUpdate);
    actionSheet.getRange(targetRow, notesCol + 1).setValue(progressData.progressNotes);
    actionSheet.getRange(targetRow, budgetSpentCol + 1).setValue(progressData.budgetSpent);
    actionSheet.getRange(targetRow, updatedAtCol + 1).setValue(progressData.updatedAt);
    actionSheet.getRange(targetRow, updatedByCol + 1).setValue(progressData.updatedBy);
    
    // è®°å½•è¿›åº¦å†å²
    recordProgressHistory(progressData);
    
    // æ›´æ–°é‡Œç¨‹ç¢‘çŠ¶æ€
    if (progressData.milestonesStatus) {
      updateMilestonesStatus(progressData.actionId, progressData.milestonesStatus);
    }
    
    // å¦‚æœè¡ŒåŠ¨å®Œæˆï¼Œæ›´æ–°ç›¸å…³æ´å¯ŸçŠ¶æ€
    if (progressData.statusUpdate === 'completed') {
      updateRelatedInsightStatus(progressData.actionId, 'action_completed');
    }
    
    return {
      success: true,
      actionId: progressData.actionId,
      message: 'è¿›åº¦æ›´æ–°æˆåŠŸ'
    };
    
  } catch (error) {
    console.error('æ›´æ–°è¡ŒåŠ¨è¿›åº¦å¤±è´¥:', error);
    throw new Error(`æ›´æ–°å¤±è´¥: ${error.message}`);
  }
}

// è®°å½•è¿›åº¦å†å²
function recordProgressHistory(progressData) {
  try {
    // è·å–æˆ–åˆ›å»ºè¿›åº¦å†å²è¡¨
    const historySheet = getOrCreateProgressHistorySheet();
    
    const historyData = [
      generateProgressHistoryId(),
      progressData.actionId,
      progressData.progressPercentage,
      progressData.statusUpdate,
      progressData.progressNotes,
      progressData.nextSteps,
      progressData.risksIssues,
      progressData.updatedBy,
      progressData.updatedAt
    ];
    
    historySheet.appendRow(historyData);
    
  } catch (error) {
    console.error('è®°å½•è¿›åº¦å†å²å¤±è´¥:', error);
    // å†å²è®°å½•å¤±è´¥ä¸åº”è¯¥å½±å“ä¸»æµç¨‹
  }
}


// è·å–æˆ–åˆ›å»ºè¿›åº¦å†å²è¡¨
function getOrCreateProgressHistorySheet() {
  const spreadsheet = SpreadsheetApp.openById(ACTION_RECOMMENDATIONS_SHEET_ID);
  let historySheet = spreadsheet.getSheetByName('Progress_History');
  
  if (!historySheet) {
    historySheet = spreadsheet.insertSheet('Progress_History');
    const headers = [
      'history_id', 'action_id', 'progress_percentage', 'status',
      'progress_notes', 'next_steps', 'risks_issues', 'updated_by', 'updated_at'
    ];
    historySheet.getRange(1, 1, 1, headers.length).setValues([headers]);
  }
  
  return historySheet;
}

// ç”Ÿæˆè¿›åº¦å†å²ID
function generateProgressHistoryId() {
  const timestamp = new Date().toISOString().replace(/[-:T.]/g, '').substring(0, 14);
  const random = Math.random().toString(36).substring(2, 4).toUpperCase();
  return `PH${timestamp}${random}`;
}
```

è¿™ä¸ªå®Œå–„ç‰ˆæœ¬çš„è®¾è®¡æ–‡æ¡£ç°åœ¨åŒ…å«äº†ï¼š

1. **å…¨ç³»ç»Ÿæ•°å­—ç‚¹å‡»å±•å¼€åŠŸèƒ½** - æ‰€æœ‰é¡µé¢çš„æ•°å­—æŒ‡æ ‡éƒ½æ”¯æŒç‚¹å‡»å±•å¼€ï¼Œç»Ÿä¸€çš„äº¤äº’è§„èŒƒå’Œæ ·å¼
2. **é«˜ä»·å€¼çº¿ç´¢è¡ŒåŠ¨è¾“å…¥åŠŸèƒ½** - å®Œæ•´çš„è¡ŒåŠ¨è®¡åˆ’è¾“å…¥ç•Œé¢ï¼Œæ”¯æŒè¯¦ç»†çš„è¡ŒåŠ¨è§„åˆ’å’Œæ•°æ®åº“å†™å…¥
3. **è¡ŒåŠ¨è¿›åº¦è·Ÿè¸ªå’Œæ›´æ–°** - æ”¯æŒè¡ŒåŠ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è¿›åº¦æ›´æ–°ã€çŠ¶æ€å˜æ›´å’Œå†å²è®°å½•
4. **æ•°æ®åº“é›†æˆ** - å®Œæ•´çš„åç«¯æœåŠ¡ï¼Œæ”¯æŒæ•°æ®çš„è¯»å–ã€å†™å…¥å’Œæ›´æ–°æ“ä½œ
5. **é€šçŸ¥å’Œæé†’æœºåˆ¶** - è¡ŒåŠ¨åˆ†é…é€šçŸ¥ã€è¿›åº¦æé†’ç­‰åŠŸèƒ½

æ•´ä¸ªç³»ç»Ÿè®¾è®¡ç¡®ä¿äº†ä»æŠ€æœ¯æ´å¯Ÿå‘ç°åˆ°è¡ŒåŠ¨æ‰§è¡Œçš„å®Œæ•´é—­ç¯ç®¡ç†ï¼Œä¸ºå†³ç­–è€…æä¾›äº†å¼ºå¤§çš„æŠ€æœ¯æƒ…æŠ¥åˆ†æå’Œè¡ŒåŠ¨ç®¡ç†èƒ½åŠ›ã€‚
