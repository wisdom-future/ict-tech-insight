name: Final Fix - Complete Rebuild

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  final-fix:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Create minimal working router
      run: |
        cat > src/router/index.js << 'EOF'
        import { createRouter, createWebHistory } from 'vue-router'

        const routes = [
          {
            path: '/',
            name: 'Overview',
            component: () => import('../views/Overview.vue')
          },
          {
            path: '/collection',
            name: 'Collection', 
            component: () => import('../views/Collection.vue')
          },
          {
            path: '/analysis',
            name: 'Analysis',
            component: () => import('../views/Analysis.vue')
          },
          {
            path: '/action',
            name: 'Action',
            component: () => import('../views/Action.vue')
          },
          {
            path: '/reports',
            name: 'Reports',
            component: () => import('../views/Reports.vue')
          }
        ]

        const router = createRouter({
          history: createWebHistory('/ict-tech-insight/'),
          routes
        })

        export default router
        EOF

    - name: Create minimal vite config
      run: |
        cat > vite.config.js << 'EOF'
        import { defineConfig } from 'vite'
        import vue from '@vitejs/plugin-vue'

        export default defineConfig({
          plugins: [vue()],
          base: '/ict-tech-insight/',
          build: {
            outDir: 'dist'
          }
        })
        EOF

    - name: Create simple main.js
      run: |
        cat > src/main.js << 'EOF'
        import { createApp } from 'vue'
        import App from './App.vue'
        import router from './router/index.js'

        const app = createApp(App)
        app.use(router)
        app.mount('#app')
        EOF

    - name: Create working App.vue
      run: |
        cat > src/App.vue << 'EOF'
        <template>
          <div id="app">
            <header style="background: white; border-bottom: 1px solid #e5e7eb; padding: 1rem 1.5rem;">
              <h1 style="color: #2563eb; font-size: 1.5rem; font-weight: bold;">ğŸš€ ICT Tech Insight</h1>
            </header>
            
            <div style="display: flex; min-height: calc(100vh - 60px);">
              <nav style="width: 250px; background: white; border-right: 1px solid #e5e7eb; padding: 1rem;">
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                  <router-link to="/" style="padding: 0.75rem; text-decoration: none; color: #374151; border-radius: 0.375rem; display: flex; align-items: center; gap: 0.5rem;">
                    ğŸ  æ¦‚è§ˆä»ªè¡¨æ¿
                  </router-link>
                  <router-link to="/collection" style="padding: 0.75rem; text-decoration: none; color: #374151; border-radius: 0.375rem; display: flex; align-items: center; gap: 0.5rem;">
                    ğŸ“¥ æ•°æ®é‡‡é›†ç›‘æ§
                  </router-link>
                  <router-link to="/analysis" style="padding: 0.75rem; text-decoration: none; color: #374151; border-radius: 0.375rem; display: flex; align-items: center; gap: 0.5rem;">
                    ğŸ§  æ™ºèƒ½åˆ†æä¸­å¿ƒ
                  </router-link>
                  <router-link to="/action" style="padding: 0.75rem; text-decoration: none; color: #374151; border-radius: 0.375rem; display: flex; align-items: center; gap: 0.5rem;">
                    ğŸ¯ è¡ŒåŠ¨å†³ç­–ä¸­å¿ƒ
                  </router-link>
                  <router-link to="/reports" style="padding: 0.75rem; text-decoration: none; color: #374151; border-radius: 0.375rem; display: flex; align-items: center; gap: 0.5rem;">
                    ğŸ“‘ æŠ¥å‘Šä¸­å¿ƒ
                  </router-link>
                </div>
              </nav>
              
              <main style="flex: 1; padding: 1.5rem; background: #f9fafb;">
                <router-view />
              </main>
            </div>
          </div>
        </template>

        <script>
        export default {
          name: 'App'
        }
        </script>

        <style>
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }

        body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .router-link-active {
          background-color: #dbeafe !important;
          color: #1d4ed8 !important;
        }

        a:hover {
          background-color: #f3f4f6 !important;
        }
        </style>
        EOF

    - name: Ensure all view files exist with basic content
      run: |
        # Overview.vue
        cat > src/views/Overview.vue << 'EOF'
        <template>
          <div>
            <h1 style="font-size: 2rem; font-weight: bold; margin-bottom: 1.5rem;">æ¦‚è§ˆä»ªè¡¨æ¿</h1>
            
            <div style="background: white; padding: 1.5rem; border-radius: 0.5rem; margin-bottom: 1.5rem;">
              <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                <span style="color: #22c55e; font-size: 1.25rem; margin-right: 0.5rem;">âœ…</span>
                <span style="font-weight: 600;">ç³»ç»ŸçŠ¶æ€: æ­£å¸¸è¿è¡Œ</span>
              </div>
              <p>Vue.js åº”ç”¨å·²æˆåŠŸå¯åŠ¨ï¼Œè·¯ç”±åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼</p>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
              <div style="background: white; padding: 1.5rem; border-radius: 0.5rem; text-align: center;">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ“Š</div>
                <h3>ä»Šæ—¥æ–°å¢ä¿¡æ¯</h3>
                <p style="font-size: 2rem; font-weight: bold; color: #2563eb;">23</p>
              </div>
              
              <div style="background: white; padding: 1.5rem; border-radius: 0.5rem; text-align: center;">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ¯</div>
                <h3>é«˜ä»·å€¼ä¿¡å·</h3>
                <p style="font-size: 2rem; font-weight: bold; color: #22c55e;">8</p>
              </div>
              
              <div style="background: white; padding: 1.5rem; border-radius: 0.5rem; text-align: center;">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">âš ï¸</div>
                <h3>å¾…å†³ç­–äº‹é¡¹</h3>
                <p style="font-size: 2rem; font-weight: bold; color: #f59e0b;">5</p>
              </div>
              
              <div style="background: white; padding: 1.5rem; border-radius: 0.5rem; text-align: center;">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ’š</div>
                <h3>ç³»ç»Ÿå¥åº·åº¦</h3>
                <p style="font-size: 2rem; font-weight: bold; color: #22c55e;">98.5%</p>
              </div>
            </div>
          </div>
        </template>

        <script>
        export default {
          name: 'Overview'
        }
        </script>
        EOF

        # Collection.vue
        cat > src/views/Collection.vue << 'EOF'
        <template>
          <div>
            <h1 style="font-size: 2rem; font-weight: bold; margin-bottom: 1.5rem;">æ•°æ®é‡‡é›†ç›‘æ§</h1>
            <div style="background: white; padding: 1.5rem; border-radius: 0.5rem;">
              <p>æ•°æ®é‡‡é›†ç›‘æ§é¡µé¢æ­£åœ¨å¼€å‘ä¸­...</p>
            </div>
          </div>
        </template>

        <script>
        export default {
          name: 'Collection'
        }
        </script>
        EOF

        # Analysis.vue
        cat > src/views/Analysis.vue << 'EOF'
        <template>
          <div>
            <h1 style="font-size: 2rem; font-weight: bold; margin-bottom: 1.5rem;">æ™ºèƒ½åˆ†æä¸­å¿ƒ</h1>
            <div style="background: white; padding: 1.5rem; border-radius: 0.5rem;">
              <p>æ™ºèƒ½åˆ†æä¸­å¿ƒé¡µé¢æ­£åœ¨å¼€å‘ä¸­...</p>
            </div>
          </div>
        </template>

        <script>
        export default {
          name: 'Analysis'
        }
        </script>
        EOF

        # Action.vue
        cat > src/views/Action.vue << 'EOF'
        <template>
          <div>
            <h1 style="font-size: 2rem; font-weight: bold; margin-bottom: 1.5rem;">è¡ŒåŠ¨å†³ç­–ä¸­å¿ƒ</h1>
            <div style="background: white; padding: 1.5rem; border-radius: 0.5rem;">
              <p>è¡ŒåŠ¨å†³ç­–ä¸­å¿ƒé¡µé¢æ­£åœ¨å¼€å‘ä¸­...</p>
            </div>
          </div>
        </template>

        <script>
        export default {
          name: 'Action'
        }
        </script>
        EOF

        # Reports.vue
        cat > src/views/Reports.vue << 'EOF'
        <template>
          <div>
            <h1 style="font-size: 2rem; font-weight: bold; margin-bottom: 1.5rem;">æŠ¥å‘Šä¸­å¿ƒ</h1>
            <div style="background: white; padding: 1.5rem; border-radius: 0.5rem;">
              <p>æŠ¥å‘Šä¸­å¿ƒé¡µé¢æ­£åœ¨å¼€å‘ä¸­...</p>
            </div>
          </div>
        </template>

        <script>
        export default {
          name: 'Reports'
        }
        </script>
        EOF

    - name: Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add .
        git commit -m "ğŸ”§ Final fix: Complete rebuild with working Vue app"
        git push
